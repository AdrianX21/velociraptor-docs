<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.84.1"><meta name=description content><link rel=icon href=/images/favicon.png type=image/png><title>Deployment :: Velociraptor - Digging deeper!</title><link href=/css/nucleus.css?1624617393 rel=stylesheet><link href=/css/fontawesome-all.min.css?1624617393 rel=stylesheet><link href=/css/hybrid.css?1624617393 rel=stylesheet><link href=/css/featherlight.min.css?1624617393 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1624617393 rel=stylesheet><link href=/css/auto-complete.css?1624617393 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1624617393 rel=stylesheet><link href=/css/theme.css?1624617393 rel=stylesheet><link href=/css/tabs.css?1624617393 rel=stylesheet><link href=/css/hugo-theme.css?1624617393 rel=stylesheet><link href=/css/theme-mine.css?1624617393 rel=stylesheet><link href=/css/atom-one-light.css?1624617393 rel=stylesheet><link href=/css/dark.css?1624617393 rel=stylesheet><link href=/css/light.css?1624617393 rel=stylesheet><link href=https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css?1624617393 rel=stylesheet><script src=/js/jquery-3.3.1.min.js?1624617393></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style><script></script></head><body data-url=/docs/overview/deployment/><nav id=sidebar><div id=header-wrapper><div id=header><script>function darkmode(){$("body").addClass("dark").removeClass("light"),document.cookie="theme=darkmode;path=/"}function lightmode(){$("body").removeClass("dark").addClass("light"),document.cookie="theme=lightmode;path=/"}const regex=new RegExp('theme=darkmode');regex.test(document.cookie)?darkmode():lightmode()</script><div class="btn btn-default ThemeSelector darkmode" onclick=darkmode()><i class="fas fa-moon"></i></div><div class="btn btn-default ThemeSelector lightmode" onclick=lightmode()><i class="fas fa-sun"></i></div><a href=https://docs.velociraptor.app/><img src=https://docs.velociraptor.app//images/logo.svg></a></div></div><div class=highlightable><ul class=topics><li data-nav-id=https://docs.velociraptor.app/docs/ class="dd-item parent haschildren"><div><i class="fa fa-angle-down fa-sm category-icon"></i>
<a href=/docs/><i class="fas fa-book-reader"></i>Documentation</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/overview/ class="dd-item parent haschildren"><div><i class="fa fa-angle-down fa-sm category-icon"></i>
<a href=/docs/overview/>Velociraptor Overview</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/overview/history/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/overview/history/>History</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/overview/deployment/ class="dd-item parent active haschildren"><div><i class="fa fa-angle-down fa-sm category-icon"></i>
<a href=/docs/overview/deployment/>Deployment</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/overview/deployment/self-signed/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/overview/deployment/self-signed/>Self Signed SSL</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/overview/deployment/cloud/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/overview/deployment/cloud/>Cloud Deployment</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/overview/deployment/clients/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/overview/deployment/clients/>Deploying Clients</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/overview/deployment/rbac/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/overview/deployment/rbac/>Users and Roles</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/overview/deployment/resources/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/overview/deployment/resources/>Performance</a></div></li></ul></li></ul></li><li data-nav-id=https://docs.velociraptor.app/docs/gui/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/gui/>The Admin GUI</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/gui/clients/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/gui/clients/>Inspecting clients</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/gui/vfs/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/gui/vfs/>The VFS</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/gui/artifacts/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/gui/artifacts/>Artifacts</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/gui/hunting/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/gui/hunting/>Hunting</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/docs/vql/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/vql/>VQL Fundamentals</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/vql/notebooks/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/vql/notebooks/>Notebooks</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/vql/artifacts/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/vql/artifacts/>Artifacts</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/vql/events/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/vql/events/>Event Queries</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/docs/forensic/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/forensic/>Forensic Analysis</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/forensic/filesystem/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/filesystem/>Searching Filenames</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/forensic/searching/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/searching/>Searching Content</a></div></li></ul></li></ul></li><hr><li data-nav-id=https://docs.velociraptor.app/vql_reference/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/vql_reference/><i class="fas fa-book"></i>VQL Reference</a></div><ul><li data-nav-id=https://docs.velociraptor.app/vql_reference/basic/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/basic/>Basic VQL</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/windows/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/windows/>Windows Specific</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/parsers/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/parsers/>Parsers</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/server/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/server/>Server Side</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/plugin/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/plugin/>Client Side</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/event/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/event/>Event Plugins</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/experimental/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/experimental/>Experimental</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/misc/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/misc/>Misc</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/training/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/training/><i class="fas fa-graduation-cap"></i>Velociraptor Training</a></div></li><li data-nav-id=https://docs.velociraptor.app/blog/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/blog/><i class="fas fa-newspaper"></i>Velociraptor Blog</a></div></li><li data-nav-id=https://docs.velociraptor.app/exchange/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/exchange/><i class="fas fa-code"></i>Artifact Exchange</a></div></li><li data-nav-id=https://docs.velociraptor.app/search/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/search/><i class="fas fa-search"></i>Search</a></div></li></ul><hr><section id=shortcuts><h3></h3><ul><li><a class=padding href=https://github.com/Velocidex/velociraptor><i class="fab fa-github"></i>Github</a></li><li><a class=padding href=https://docs.velociraptor.app/discord/><i class="fab fa-discord"></i>Discord</a></li><li><a class=padding href=mailto:velociraptor-discuss@googlegroups.com><i class="fas fa-envelope"></i>Mailing List</a></li></ul></section><section id=footer><div class=footer-copyright>Brough to you by
<img src=/images/Rapid7_logo.svg class=rapid7><br><i class="fas fa-copyright"></i> 2021</div></section></div></nav><script>$("#sidebar i.fa-angle-right").each(function(){$(this).parent().parent().find("ul").hide()})</script><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=top-github-link><a class=github-link title="Edit this page" href=https://github.com/scudette/velociraptor-docs/edit/master/content/docs/overview/deployment/_index.md target=blank><i class="fas fa-code-branch"></i>
<span id=top-github-link-text>Edit this page</span></a></div><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links>Deployment</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li><a href=#typical-deployment>Typical Deployment</a></li><li><a href=#resource-considerations>Resource considerations</a></li><li><a href=#instant-velociraptor>Instant Velociraptor</a></li><li><a href=#common-deployment-scenarios>Common deployment scenarios</a></li><li><a href=#automating-config-generation>Automating config generation</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Deployment</h1><p>Velociraptor can be deployed in a number of scenarios depending on
need. The diagram below illustrates what a typical Velociraptor deployment looks like.</p><p><img src="overview.png?width=80pc&classes=shadow" alt="Deployment Overview"></p><p>The Velociraptor server is typically deployed on a cloud VM and runs a number of components as separate threads. The GUI serves the Admin UI - a Web application that can be used to control Velociraptor and orchestrate hunts and collections from the endpoints.</p><p>The endpoints themselves run the <strong>Velociraptor Client</strong> as a
service. The client is simply the Velociraptor instance running on the
endpoint.</p><p>Clients have a persistent connection with the server. The server is
therefore able to issue a task to the clients immediately as soon as
the User scheduled it (Many other solutions rely on periodic polling
between endpoint and the server leading to latency between issuing a
new task and receiving the results - not so with Velociraptor).</p><p>Velociraptor is distributed as a <strong>Single Binary</strong> for ease of
deployment. The same binary can act as a server, client or a number of
utility programs depending on command line flags.</p><p>Velociraptor does not use an external datastore - all data is stored
within the server&rsquo;s filesystem in regular files and directories making
backups and data lifecycle management a breeze. Therefore you do not
need any additional infrastructure such as databases or cloud
services. Velociraptor is compatible with distributed filesystems such
as Amazon EFS, Google Filestore or generic NFS.</p><h3 id=typical-deployment>Typical Deployment</h3><p>By deployment we mean to stand up a new Velociraptor server instance. Typically this consists of a number of broad steps:</p><ol><li>Generate a configuration file for the server and clients</li><li>Create a server package for deployment which includes the generated configuration file.</li><li>Spin up a cloud VM for the server (If deploying in the cloud) or create a new physical server.</li><li>Install the server package on the VM - this will bring the GUI and frontends up.</li><li>Create client packages for target operating systems (e.g. MSI for windows).</li></ol><p>Each deployment relies on unique configuration files, which include
information such as connection URLs, DNS names and unique
cryptographic keys. The configuration files ensure that one
Velociraptor deployment can not connect with another deployment since
key material is unique to each deployment.</p><div class="mynotices info"><div><p>We typically use Ubuntu or Debian based VMs to deploy the server in
production. We do not support Windows based servers at scale, although
it is fine to install the server on windows for a demo or for a few
endpoints.</p></div></div><h3 id=resource-considerations>Resource considerations</h3><p>The secret behind Velociraptor&rsquo;s scalability lies in the use of VQL to
query the endpoint. The server does not usually have to do much work:
All the server does is send a VQL query to the endpoints. The VQL
query executes on the endpoint and any results from the query (Queries
always returns rows encoded in JSON) are sent back to the server. The
server simply needs to write the queries into its filesystem &ndash;
Typically the server does not need to parse or process the responses
from the endpoint.</p><p>Because the server performs minimal processing on the collected data,
it is able to handle a very high volume of requests simultaneously.</p><p>See <a href=resources>Performance Considerations</a> for a discussion of
resource sizing and scale related tuning parameters available.</p><h3 id=instant-velociraptor>Instant Velociraptor</h3><p>If you just want to play with Velociraptor, you do not need to deploy
a complete server. Simply download the Velociraptor executable for
your platform from the <a href=https://github.com/Velocidex/velociraptor/releases>GitHub project&rsquo;s releases page</a>
and start it with the <code>gui</code> command.</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>Velociraptor.exe gui
</code></pre></div><p>The <code>gui</code> command automatically creates a new server and client
configuration files with the server:</p><ul><li>Server only listening on the local loopback interface.</li><li>Client will connect to the server over the loopback.</li><li>Datastore directory is set to the user&rsquo;s temp folder.</li><li>A single administrator user is created with username <code>admin</code> and password <code>password</code>.</li><li>A browser is launched with those credentials to connect to the welcome screen.</li></ul><div class="mynotices tip"><div><p>By default the <code>gui</code> command uses the temp folder
as it&rsquo;s data store. Most OS&rsquo;s clean the temp folder periodically so if
you frequently use the same folder you might find missing files. You
can specify a different data store directory using the <code>--datastore</code>
flag to work with a persistently stored data store.</p></div></div><h3 id=common-deployment-scenarios>Common deployment scenarios</h3><ul class="children children-li"><li><a href=/docs/overview/deployment/self-signed/>Self Signed SSL</a></li><li><a href=/docs/overview/deployment/cloud/>Cloud Deployment</a></li><li><a href=/docs/overview/deployment/clients/>Deploying Clients</a></li><li><a href=/docs/overview/deployment/rbac/>Users and Roles</a></li><li><a href=/docs/overview/deployment/resources/>Performance</a></li></ul><h4 id=self-signed-ssl-mode>Self Signed SSL mode</h4><p>Frontend served using TLS on port 8000 (connected to clients)
GUI uses basic authentication with usernames/passwords.
GUI Served over loopback port 8889 (127.0.0.1)
By default not exposed to the network
You can use SSH tunneling to forward the GUI</p><h4 id=installing-a-new-server>Installing a new server</h4><p>Use the password provided in the Workshop setup to log into the server.
Fetch the latest Velociraptor Windows and Linux release binaries
Create a new configuration</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>velociraptor config generate -i
</code></pre></div><p>Create a new server debian package</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>velociraptor.exe --config server.config.yaml debian server  --binary velociraptor-v0.5.5-windows.exe
</code></pre></div><h4 id=installing-a-new-server-1>Installing a new server</h4><p>Push the debian package to the server using scp</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>scp velociraptor_server*.deb mike@123.45.67.89:/tmp/
</code></pre></div><p>Install package</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>sudo dpkg -i velociraptor_server*.deb
</code></pre></div><h3 id=automating-config-generation>Automating config generation</h3><p>Some people want to automate the config generation step.
Velociraptor supports a JSON merge for non interactive configuration generation</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh>velociraptor config generate --merge
    <span class=s1>&#39;{&#34;autocert_domain&#34;: &#34;domain.com&#34;, &#34;autocert_cert_cache&#34;: &#34;/foo/bar&#34;}&#39;</span>
</code></pre></div><p>The service adds a new velociraptor user to run under.
You can now access the Velociraptor server using your browser.</p><p>The first time you navigate to the SSL URL the server will obtain a
certificate from Let&rsquo;s Encrypt. There will be a small pause as this
happens.</p><p>You will be redirected to Google for authentication - Velociraptor
does not handle any credentials in this configuration. Google will
determine if the user authenticated properly (2 FA etc) and convey
simple info like the user’s email address and avatar.</p><footer class=footline></footer></div></div><div id=navigation></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1624617393></script><script src=/js/perfect-scrollbar.min.js?1624617393></script><script src=/js/perfect-scrollbar.jquery.min.js?1624617393></script><script src=/js/jquery.sticky.js?1624617393></script><script src=/js/featherlight.min.js?1624617393></script><script src=/js/highlight.pack.js?1624617393></script><script>hljs.initHighlightingOnLoad()</script><script src=/js/modernizr.custom-3.6.0.js?1624617393></script><script src=/js/learn.js?1624617393></script><script src=/js/hugo-learn.js?1624617393></script></body></html>