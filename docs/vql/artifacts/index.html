<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.85.0"><meta name=description content><link rel=icon href=/images/favicon.png type=image/png><title>Artifacts :: Velociraptor - Digging deeper!</title><link href=/css/nucleus.css?1626066100 rel=stylesheet><link href=/css/fontawesome-all.min.css?1626066100 rel=stylesheet><link href=/css/featherlight.min.css?1626066100 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1626066100 rel=stylesheet><link href=/css/auto-complete.css?1626066100 rel=stylesheet><link href=/css/theme.css?1626066100 rel=stylesheet><link href=/css/tabs.css?1626066100 rel=stylesheet><link href=/css/hugo-theme.css?1626066100 rel=stylesheet><link href=/css/theme-mine.css?1626066100 rel=stylesheet><link href=/css/atom-one-light.css?1626066100 rel=stylesheet><link href=/css/dark.css?1626066100 rel=stylesheet><link href=/css/syntax.css?1626066100 rel=stylesheet><link href=/css/light.css?1626066100 rel=stylesheet><link href=https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css?1626066100 rel=stylesheet><script src=/js/jquery-3.3.1.min.js?1626066100></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style><script></script></head><body data-url=/docs/vql/artifacts/><nav id=sidebar><div id=header-wrapper><div id=header><script>function darkmode(){$("body").addClass("dark").removeClass("light"),document.cookie="theme=darkmode;path=/"}function lightmode(){$("body").removeClass("dark").addClass("light"),document.cookie="theme=lightmode;path=/"}const regex=new RegExp('theme=darkmode');regex.test(document.cookie)?darkmode():lightmode()</script><div class="btn btn-default ThemeSelector darkmode" onclick=darkmode()><i class="fas fa-moon"></i></div><div class="btn btn-default ThemeSelector lightmode" onclick=lightmode()><i class="fas fa-sun"></i></div><a href=https://docs.velociraptor.app/><img src=https://docs.velociraptor.app//images/logo.svg></a></div></div><div class=highlightable><ul class=topics><li data-nav-id=https://docs.velociraptor.app/docs/ class="dd-item parent haschildren"><div><i class="fa fa-angle-down fa-sm category-icon"></i>
<a href=/docs/><i class="fas fa-book-reader"></i>Documentation</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/overview/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/overview/>Velociraptor Overview</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/overview/history/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/overview/history/>History</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/overview/deployment/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/overview/deployment/>Deployment</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/overview/deployment/self-signed/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/overview/deployment/self-signed/>Self-Signed SSL</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/overview/deployment/cloud/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/overview/deployment/cloud/>Cloud Deployment</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/overview/deployment/clients/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/overview/deployment/clients/>Deploying Clients</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/overview/deployment/rbac/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/overview/deployment/rbac/>Users and Roles</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/overview/deployment/resources/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/overview/deployment/resources/>Performance</a></div></li></ul></li></ul></li><li data-nav-id=https://docs.velociraptor.app/docs/gui/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/gui/>The Admin GUI</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/gui/clients/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/gui/clients/>Inspecting clients</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/gui/vfs/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/gui/vfs/>The VFS</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/gui/artifacts/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/gui/artifacts/>Artifacts</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/gui/hunting/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/gui/hunting/>Hunting</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/docs/vql/ class="dd-item parent haschildren"><div><i class="fa fa-angle-down fa-sm category-icon"></i>
<a href=/docs/vql/>VQL Fundamentals</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/vql/notebooks/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/vql/notebooks/>Notebooks</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/vql/artifacts/ class="dd-item parent active"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/vql/artifacts/>Artifacts</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/vql/events/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/vql/events/>Event Queries</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/docs/forensic/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/forensic/>Forensic Analysis</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/forensic/filesystem/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/filesystem/>Searching Filenames</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/forensic/searching/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/searching/>Searching Content</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/forensic/ntfs/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/ntfs/>NTFS Analysis</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/forensic/evidence_of_execution/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/evidence_of_execution/>Evidence Of Execution</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/forensic/event_logs/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/event_logs/>Event Logs</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/forensic/volatile/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/volatile/>Volatile machine state</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/docs/offline_triage/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/offline_triage/>Triage and acquisition</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/extending_vql/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/extending_vql/>Extending VQL</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/server_automation/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/server_automation/>Server Automation</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/api/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/api/>The API</a></div></li></ul></li><hr><li data-nav-id=https://docs.velociraptor.app/vql_reference/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/vql_reference/><i class="fas fa-book"></i>VQL Reference</a></div><ul><li data-nav-id=https://docs.velociraptor.app/vql_reference/basic/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/basic/>Basic VQL</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/windows/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/windows/>Windows Specific</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/parsers/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/parsers/>Parsers</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/server/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/server/>Server Side</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/plugin/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/plugin/>Client Side</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/event/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/event/>Event Plugins</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/experimental/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/experimental/>Experimental</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/misc/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/misc/>Misc</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/training/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/training/><i class="fas fa-graduation-cap"></i>Velociraptor Training</a></div></li><li data-nav-id=https://docs.velociraptor.app/blog/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/blog/><i class="fas fa-newspaper"></i>Velociraptor Blog</a></div></li><li data-nav-id=https://docs.velociraptor.app/exchange/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/exchange/><i class="fas fa-code"></i>Artifact Exchange</a></div></li><li data-nav-id=https://docs.velociraptor.app/search/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/search/><i class="fas fa-search"></i>Search</a></div></li></ul><hr><section id=shortcuts><h3></h3><ul><li><a class=padding href=https://github.com/Velocidex/velociraptor><i class="fab fa-github"></i>Github</a></li><li><a class=padding href=https://docs.velociraptor.app/discord/><i class="fab fa-discord"></i>Discord</a></li><li><a class=padding href=mailto:velociraptor-discuss@googlegroups.com><i class="fas fa-envelope"></i>Mailing List</a></li></ul></section><section id=footer><div class=footer-copyright>Brough to you by
<img src=/images/Rapid7_logo.svg class=rapid7><br><i class="fas fa-copyright"></i> 2021</div></section></div></nav><script>$("#sidebar i.fa-angle-right").each(function(){$(this).parent().parent().find("ul").hide()})</script><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=top-github-link><a class=github-link title="Edit this page" href=https://github.com/scudette/velociraptor-docs/edit/master/content/docs/vql/artifacts/_index.md target=blank><i class="fas fa-code-branch"></i>
<span id=top-github-link-text>Edit this page</span></a></div><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links>Artifacts</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#parameters>Parameters</a><ul><li><a href=#parameter-types>Parameter types</a></li><li><a href=#example>Example</a></li></ul></li><li><a href=#artifact-writing-tips>Artifact writing tips</a></li><li><a href=#calling-artifacts-from-vql>Calling artifacts from VQL</a></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Artifacts</h1><p>Velociraptor allows packaging VQL queries inside mini-programs called
<code>Artifacts</code>. An artifact is simply a structured YAML file containing a
query, with a name attached to it. This allows Velociraptor users to
search for the query by name or description and simply run the query
on the endpoint without necessaily needing to understand or type the
query into the UI.</p><p>Therefore Artifacts can be thought of as VQL modules.</p><p>Usually an artifact is geared towards collecting a single type of
information from the endpoint. For example consider the following
artifact:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Custom.Artifact.Name</span><span class=w>
</span><span class=w></span><span class=nt>description</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span><span class=sd>   </span><span class=w>   </span><span class=l>This is the human readable description of the artifact.</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>CLIENT</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=nt>parameters</span><span class=p>:</span><span class=w>
</span><span class=w>   </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>FirstParameter</span><span class=w>
</span><span class=w>     </span><span class=nt>default</span><span class=p>:</span><span class=w> </span><span class=l>Default Value of first parameter</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=nt>sources</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>MySource</span><span class=w>
</span><span class=w>    </span><span class=nt>precondition</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=l>SELECT OS From info() where OS = &#39;windows&#39; OR OS = &#39;linux&#39; OR OS = &#39;darwin&#39;</span><span class=w>
</span><span class=w>
</span><span class=w>    </span><span class=nt>query</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span><span class=sd>      SELECT * FROM info()
</span><span class=sd>      LIMIT 10</span><span class=w>      
</span></code></pre></div><p>The Artifact contains a number of important parameters:</p><ol><li><strong>Name</strong>: The artifact contains a name. By convention the name is
segmented by dots in a hierarchy. The Name appears in the GUI and
can be searched on.</li><li><strong>Description</strong>: Artifacts contain a human readable description. The
description field is also searchable in the GUI and so should
contain relevant keywords that make the artifact more discoverable.</li><li><strong>Type</strong>: The type of the Artifact. Since Velociraptor uses VQL in many
different contexts, the type of the artifact hints to the GUI where
the artifact is meant to run. For example, a CLIENT artifact is
meant to be run on the endpoint, while a SERVER artifact is meant
to be run on the server. The artifact type is only relevant for the
GUI.</li><li><strong>Parameters</strong>: An artifact may declare parameters, in which case they
may be set by the GUI user to customize the artifact collection.</li><li><strong>Sources</strong>: The artifact may define a number of VQL sources to
generate result tables. Each source generates a single table. If
more than one source is given, they must all have unique names.</li><li><strong>Precondition</strong>: A source may define a precondition query. This query
will be run prior to collecting the source. If it returns no rows
then the collection will be skipped. Preconditions make it safe to
collect artifacts from all hosts (e.g. in a hunt), and ensure that
only artifacts that make sense to collect are actually run.</li><li><strong>Query</strong>: The query that will be used to collect that source. Note
that since each source <strong>must</strong> produce a single table, the query
should have exactly one <code>SELECT</code> clause and it must be at the end
of the query potentially following any <code>LET</code> queries.</li></ol><h2 id=parameters>Parameters</h2><p>Artifact parameters allow the user to customize the collection in a
controlled way - without needing to edit the VQL. The GUI will present
a form that allows the user to update the parameters prior to each
collection.</p><p>Parameters may define a type. This type will be used to hint to the
GUI how to render the form element. The type also determines how the
parameter is sent to the client and ensures the parameter appears as
that type in the query.</p><p>Prior to launching the query on the endpoint, Velociraptor will
populate the scope with the parameters. This allows the VQL query to
directly access the parameters.</p><p>Artifact parameters are sent to the client as strings The client
automatically parses them into a VQL type depending on the parameter&rsquo;s
type specification. The GUI uses type specification to render an
appropriate UI</p><h3 id=parameter-types>Parameter types</h3><p>Currently the following parameter types are supported</p><ul><li><strong>int, integer</strong>: The parameter is an integer</li><li><strong>timestamp</strong>: The parameter is a timestamp</li><li><strong>csv</strong>: Parameter appears as a list of dicts formatted as a CSV</li><li><strong>json</strong>: Parameter is a JSON encoded dict</li><li><strong>json_array</strong>: The parameter is a list of dicts encoded as a JSON blob (similar to csv)</li><li><strong>bool</strong>: The parameter is a boolean (TRUE/YES/Y/OK)</li></ul><h3 id=example>Example</h3><p>Let&rsquo;s take a look at a typical artifact <code>Windows.Detection.Mutants</code>.</p><p><figure><img src=mutants.png alt=Mutants class=captioned><figcaption>Mutants</figcaption></figure></p><p>This artifact uncovers the mutants (named mutexes) on a system, using
two methods. First we enumerate all handles, and check which process
is holding a handle to a mutant object. Alternatively we enumerate the
kernel object manager to receive the same information.</p><p>Therefore this artifact contains two sources - each gets similar
information in a different way. A user who is just interested in
listing the Mutants on an endpoint would probably need to see both
results.</p><p>We also see some parameters declared to allow a user to filter by
process name or mutant name.</p><h2 id=artifact-writing-tips>Artifact writing tips</h2><p>Typically we have a new idea for a new detection. The first step is to
develop the VQL that will detect the anomaly by writing the VQL in a
notebook cell on the target operating system itself (usually we use
<code>velociraptor gui</code> to start a new local server).</p><p>While developing the VQL, Use the <code>log()</code> VQL function librally to
provide print debugging.</p><p>Use format(format="%T %v", args=[X, X]) to learn about a value&rsquo;s type
and value 77</p><h2 id=calling-artifacts-from-vql>Calling artifacts from VQL</h2><p>You can call other artifacts from your own VQL using the
<code>Artifact.&lt;artifact name></code> plugin notation. Args to the <code>Artifact()</code>
plugin are passed as artifact parameters.</p><p><figure><img src=calling_artifacts.png alt="Calling artifacts" class=captioned><figcaption>Calling artifacts</figcaption></figure></p><p>When calling artifacts types are not converted. Make sure you pass the
expected types</p><div class="mynotices info"><div><p>When collecting an artifact from the client, the server <strong>compiles</strong>
the artifact and it&rsquo;s dependencies into raw VQL statements and sends
these to the client for evaluation. We never rely on the artifact
definitions embedded in the client itself - instead we always send the
compiled VQL to the client. This allows us to upgrade artifact
definitions on the server without needing to update the client itself.</p></div></div><footer class=footline></footer></div></div><div id=navigation></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1626066100></script><script src=/js/perfect-scrollbar.min.js?1626066100></script><script src=/js/perfect-scrollbar.jquery.min.js?1626066100></script><script src=/js/jquery.sticky.js?1626066100></script><script src=/js/featherlight.min.js?1626066100></script><script src=/js/highlight.pack.js?1626066100></script><script>hljs.initHighlightingOnLoad()</script><script src=/js/modernizr.custom-3.6.0.js?1626066100></script><script src=/js/learn.js?1626066100></script><script src=/js/hugo-learn.js?1626066100></script></body></html>