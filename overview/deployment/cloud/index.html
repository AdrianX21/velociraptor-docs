<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.83.1"><meta name=description content><link rel=icon href=/velociraptor-docs/images/favicon.png type=image/png><title>Cloud Deployment :: Velociraptor - Digging deeper!</title><link href=/velociraptor-docs/css/nucleus.css?1623424129 rel=stylesheet><link href=/velociraptor-docs/css/fontawesome-all.min.css?1623424129 rel=stylesheet><link href=/velociraptor-docs/css/hybrid.css?1623424129 rel=stylesheet><link href=/velociraptor-docs/css/featherlight.min.css?1623424129 rel=stylesheet><link href=/velociraptor-docs/css/perfect-scrollbar.min.css?1623424129 rel=stylesheet><link href=/velociraptor-docs/css/auto-complete.css?1623424129 rel=stylesheet><link href=/velociraptor-docs/css/atom-one-dark-reasonable.css?1623424129 rel=stylesheet><link href=/velociraptor-docs/css/theme.css?1623424129 rel=stylesheet><link href=/velociraptor-docs/css/tabs.css?1623424129 rel=stylesheet><link href=/velociraptor-docs/css/hugo-theme.css?1623424129 rel=stylesheet><link href=/velociraptor-docs/css/theme-mine.css?1623424129 rel=stylesheet><link href=/velociraptor-docs/css/atom-one-light.css?1623424129 rel=stylesheet><script src=/velociraptor-docs/js/jquery-3.3.1.min.js?1623424129></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/velociraptor-docs/overview/deployment/cloud/><nav id=sidebar><div id=header-wrapper><div id=header><a href=https://scudette.github.io/velociraptor-docs/><img src=https://scudette.github.io/velociraptor-docs//images/logo.svg></a></div></div><div class=highlightable><ul class=topics><li data-nav-id=/velociraptor-docs/overview/ title="Velociraptor Overview" class="dd-item
parent"><a href=/velociraptor-docs/overview/>Velociraptor Overview</a><ul><li data-nav-id=/velociraptor-docs/overview/history/ title=History class=dd-item><a href=/velociraptor-docs/overview/history/>History</a></li><li data-nav-id=/velociraptor-docs/overview/deployment/ title="Deployment Overview" class="dd-item
parent"><a href=/velociraptor-docs/overview/deployment/>Deployment Overview</a><ul><li data-nav-id=/velociraptor-docs/overview/deployment/self-signed/ title="Self Signed SSL" class=dd-item><a href=/velociraptor-docs/overview/deployment/self-signed/>Self Signed SSL</a></li><li data-nav-id=/velociraptor-docs/overview/deployment/cloud/ title="Cloud Deployment" class="dd-item
parent
active"><a href=/velociraptor-docs/overview/deployment/cloud/>Cloud Deployment</a></li><li data-nav-id=/velociraptor-docs/overview/deployment/clients/ title="Deploying Clients" class=dd-item><a href=/velociraptor-docs/overview/deployment/clients/>Deploying Clients</a></li><li data-nav-id=/velociraptor-docs/overview/deployment/rbac/ title="Users and Roles" class=dd-item><a href=/velociraptor-docs/overview/deployment/rbac/>Users and Roles</a></li><li data-nav-id=/velociraptor-docs/overview/deployment/resources/ title=Performance class=dd-item><a href=/velociraptor-docs/overview/deployment/resources/>Performance</a></li></ul></li></ul></li><li data-nav-id=/velociraptor-docs/gui/ title="The Admin GUI" class=dd-item><a href=/velociraptor-docs/gui/>The Admin GUI</a><ul><li data-nav-id=/velociraptor-docs/gui/clients/ title="Inspecting clients" class=dd-item><a href=/velociraptor-docs/gui/clients/>Inspecting clients</a></li><li data-nav-id=/velociraptor-docs/gui/vfs/ title="The VFS" class=dd-item><a href=/velociraptor-docs/gui/vfs/>The VFS</a></li><li data-nav-id=/velociraptor-docs/gui/artifacts/ title=Artifacts class=dd-item><a href=/velociraptor-docs/gui/artifacts/>Artifacts</a></li><li data-nav-id=/velociraptor-docs/gui/hunting/ title=Hunting class=dd-item><a href=/velociraptor-docs/gui/hunting/>Hunting</a></li></ul></li><li data-nav-id=/velociraptor-docs/vql/ title="VQL Fundamentals" class=dd-item><a href=/velociraptor-docs/vql/>VQL Fundamentals</a></li><li data-nav-id=/velociraptor-docs/blog/ title="Velociraptor Blog" class=dd-item><a href=/velociraptor-docs/blog/>Velociraptor Blog</a><ul><li data-nav-id=/velociraptor-docs/blog/2021/ title=2021 class=dd-item><a href=/velociraptor-docs/blog/2021/>2021</a><ul><li data-nav-id=/velociraptor-docs/blog/2021/2021-01-22-concurrent-vql-6d381fdb0b1f/ title="Concurrent VQL" class=dd-item><a href=/velociraptor-docs/blog/2021/2021-01-22-concurrent-vql-6d381fdb0b1f/>Concurrent VQL</a></li><li data-nav-id=/velociraptor-docs/blog/2021/2021-01-19-parsing-binary-files-d31114a41f14/ title="Parsing binary files" class=dd-item><a href=/velociraptor-docs/blog/2021/2021-01-19-parsing-binary-files-d31114a41f14/>Parsing binary files</a></li></ul></li><li data-nav-id=/velociraptor-docs/blog/2020/ title=2020 class=dd-item><a href=/velociraptor-docs/blog/2020/>2020</a><ul><li data-nav-id=/velociraptor-docs/blog/2020/2020-12-26-slack-and-velociraptor-b63803ba4b16/ title="Slack and Velociraptor" class=dd-item><a href=/velociraptor-docs/blog/2020/2020-12-26-slack-and-velociraptor-b63803ba4b16/>Slack and Velociraptor</a></li><li data-nav-id=/velociraptor-docs/blog/2020/2020-12-13-velociraptor-and-osquery-2a4306dd23c/ title="Velociraptor and OSQuery" class=dd-item><a href=/velociraptor-docs/blog/2020/2020-12-13-velociraptor-and-osquery-2a4306dd23c/>Velociraptor and OSQuery</a></li><li data-nav-id=/velociraptor-docs/blog/2020/2020-11-13-the-windows-usn-journal-f0c55c9010e/ title="The Windows USN Journal" class=dd-item><a href=/velociraptor-docs/blog/2020/2020-11-13-the-windows-usn-journal-f0c55c9010e/>The Windows USN Journal</a></li><li data-nav-id=/velociraptor-docs/blog/2020/2020-09-28-velociraptor-network-communications-30568624043a/ title="Velociraptor Communications" class=dd-item><a href=/velociraptor-docs/blog/2020/2020-09-28-velociraptor-network-communications-30568624043a/>Velociraptor Communications</a></li><li data-nav-id=/velociraptor-docs/blog/2020/2020-08-17-velociraptor-sso-authentication-6dd68d46dccf/ title="Velociraptor SSO Authentication" class=dd-item><a href=/velociraptor-docs/blog/2020/2020-08-17-velociraptor-sso-authentication-6dd68d46dccf/>Velociraptor SSO Authentication</a></li><li data-nav-id=/velociraptor-docs/blog/2020/2020-08-16-profiling-the-beast-58913437fd16/ title="Profiling the beast" class=dd-item><a href=/velociraptor-docs/blog/2020/2020-08-16-profiling-the-beast-58913437fd16/>Profiling the beast</a></li><li data-nav-id=/velociraptor-docs/blog/2020/2020-07-14-triage-with-velociraptor-pt-4-cf0e60810d1e/ title="Triage with Velociraptor — Pt 4" class=dd-item><a href=/velociraptor-docs/blog/2020/2020-07-14-triage-with-velociraptor-pt-4-cf0e60810d1e/>Triage with Velociraptor — Pt 4</a></li><li data-nav-id=/velociraptor-docs/blog/2020/2020-07-13-velociraptor-in-the-tool-age-d896dfe71b9/ title="Velociraptor in the tool age" class=dd-item><a href=/velociraptor-docs/blog/2020/2020-07-13-velociraptor-in-the-tool-age-d896dfe71b9/>Velociraptor in the tool age</a></li><li data-nav-id=/velociraptor-docs/blog/2020/2020-06-19-the-velociraptor-query-language-pt-2-fe92bb7aa150/ title="The Velociraptor Query Language Pt 2" class=dd-item><a href=/velociraptor-docs/blog/2020/2020-06-19-the-velociraptor-query-language-pt-2-fe92bb7aa150/>The Velociraptor Query Language Pt 2</a></li><li data-nav-id=/velociraptor-docs/blog/2020/2020-06-14-the-velociraptor-query-language-pt-1-d721bff100bf/ title="The Velociraptor Query Language Pt 1" class=dd-item><a href=/velociraptor-docs/blog/2020/2020-06-14-the-velociraptor-query-language-pt-1-d721bff100bf/>The Velociraptor Query Language Pt 1</a></li><li data-nav-id=/velociraptor-docs/blog/2020/2020-04-16-velociraptor-e48a47e0317d/ title=Velociraptor class=dd-item><a href=/velociraptor-docs/blog/2020/2020-04-16-velociraptor-e48a47e0317d/>Velociraptor</a></li><li data-nav-id=/velociraptor-docs/blog/2020/2020-03-29-velociraptors-acl-model-7f497575daee/ title="Velociraptor’s ACL model" class=dd-item><a href=/velociraptor-docs/blog/2020/2020-03-29-velociraptors-acl-model-7f497575daee/>Velociraptor’s ACL model</a></li><li data-nav-id=/velociraptor-docs/blog/2020/2020-03-28-velociraptor-notebooks-d02e0bd11230/ title="Velociraptor notebooks" class=dd-item><a href=/velociraptor-docs/blog/2020/2020-03-28-velociraptor-notebooks-d02e0bd11230/>Velociraptor notebooks</a></li><li data-nav-id=/velociraptor-docs/blog/2020/2020-03-07-extending-vql-plugins-7fb004cb6ec4/ title="Extending VQL plugins" class=dd-item><a href=/velociraptor-docs/blog/2020/2020-03-07-extending-vql-plugins-7fb004cb6ec4/>Extending VQL plugins</a></li><li data-nav-id=/velociraptor-docs/blog/2020/2020-03-06-velociraptor-post-processing-with-jupyter-notebook-and-pandas-8a344d05ee8c/ title="Velociraptor Post-processing with Jupyter Notebook and Pandas" class=dd-item><a href=/velociraptor-docs/blog/2020/2020-03-06-velociraptor-post-processing-with-jupyter-notebook-and-pandas-8a344d05ee8c/>Velociraptor Post-processing with Jupyter Notebook and Pandas</a></li><li data-nav-id=/velociraptor-docs/blog/2020/2020-01-12_hunting-malware-using-mutants-ea08e86dfc19/ title="Hunting Malware using Mutants" class=dd-item><a href=/velociraptor-docs/blog/2020/2020-01-12_hunting-malware-using-mutants-ea08e86dfc19/>Hunting Malware using Mutants</a></li></ul></li><li data-nav-id=/velociraptor-docs/blog/2019/ title=2019 class=dd-item><a href=/velociraptor-docs/blog/2019/>2019</a><ul><li data-nav-id=/velociraptor-docs/blog/2019/2019-12-31_digging-into-the-system-resource-usage-monitor-srum-afbadb1a375/ title="Digging into the System Resource Usage Monitor (SRUM)" class=dd-item><a href=/velociraptor-docs/blog/2019/2019-12-31_digging-into-the-system-resource-usage-monitor-srum-afbadb1a375/>Digging into the System Resource Usage Monitor (SRUM)</a></li><li data-nav-id=/velociraptor-docs/blog/2019/2019-12-08-velociraptor-to-elasticsearch-3a9fc02c6568/ title="Velociraptor to Elasticsearch" class=dd-item><a href=/velociraptor-docs/blog/2019/2019-12-08-velociraptor-to-elasticsearch-3a9fc02c6568/>Velociraptor to Elasticsearch</a></li><li data-nav-id=/velociraptor-docs/blog/2019/2019-11-15_recovering-deleted-ntfs-files-with-velociraptor-1fcf09855311/ title="Recovering deleted NTFS Files with Velociraptor" class=dd-item><a href=/velociraptor-docs/blog/2019/2019-11-15_recovering-deleted-ntfs-files-with-velociraptor-1fcf09855311/>Recovering deleted NTFS Files with Velociraptor</a></li><li data-nav-id=/velociraptor-docs/blog/2019/2019-11-12_windows-event-logs-d8d8e615c9ca/ title="Windows Event Logs" class=dd-item><a href=/velociraptor-docs/blog/2019/2019-11-12_windows-event-logs-d8d8e615c9ca/>Windows Event Logs</a></li><li data-nav-id=/velociraptor-docs/blog/2019/2019-10-08_triage-with-velociraptor-pt-3-d6f63215f579/ title="Triage with Velociraptor — Pt 3" class=dd-item><a href=/velociraptor-docs/blog/2019/2019-10-08_triage-with-velociraptor-pt-3-d6f63215f579/>Triage with Velociraptor — Pt 3</a></li><li data-nav-id=/velociraptor-docs/blog/2019/2019-10-04_triage-with-velociraptor-pt-2-d0f79066ca0e/ title="Triage with Velociraptor — Pt 2" class=dd-item><a href=/velociraptor-docs/blog/2019/2019-10-04_triage-with-velociraptor-pt-2-d0f79066ca0e/>Triage with Velociraptor — Pt 2</a></li><li data-nav-id=/velociraptor-docs/blog/2019/2019-10-02_triage-with-velociraptor-pt-1-253f57ce96c0/ title="Triage with Velociraptor — Pt 1" class=dd-item><a href=/velociraptor-docs/blog/2019/2019-10-02_triage-with-velociraptor-pt-1-253f57ce96c0/>Triage with Velociraptor — Pt 1</a></li><li data-nav-id=/velociraptor-docs/blog/2019/2019-09-11_velociraptor-s-client-side-buffer-3ce03697a4e6/ title="Velociraptor’s client side buffer" class=dd-item><a href=/velociraptor-docs/blog/2019/2019-09-11_velociraptor-s-client-side-buffer-3ce03697a4e6/>Velociraptor’s client side buffer</a></li><li data-nav-id=/velociraptor-docs/blog/2019/2019-03-02/ title="Agentless hunting with Velociraptor" class=dd-item><a href=/velociraptor-docs/blog/2019/2019-03-02/>Agentless hunting with Velociraptor</a></li></ul></li></ul></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://github.com/Velocidex/velociraptor><i class="fab fa-github"></i> Github repo</a></li></ul></section><section id=footer><p>Built with <a href=https://github.com/matcornic/hugo-theme-learn><i class="fas fa-heart"></i></a> from <a href=https://getgrav.org>Grav</a> and <a href=https://gohugo.io/>Hugo</a></p></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links>Cloud Deployment</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#getting-a-domain-name>Getting a domain name</a></li><li><a href=#provisioning-a-virtual-machine>Provisioning a Virtual Machine</a></li><li><a href=#configure-velociraptor-to-use-autocert>Configure Velociraptor to use autocert</a></li><li><a href=#configuring-google-oauth-sso>Configuring Google OAuth SSO</a><ul><li><a href=#oauth-identity-management>OAuth Identity management</a></li><li><a href=#registering-velociraptor-as-an-oauth-application>Registering Velociraptor as an OAuth application</a></li><li><a href=#generating-configuration>Generating configuration</a></li><li><a href=#user-management>User management</a></li><li><a href=#deploying-to-the-server>Deploying to the server</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Cloud Deployment</h1><p>Many users choose to deploy Velociraptor in the cloud. This is a
convenient and reliable option. One of the advantages of cloud
deployment is the possibility of minting a proper SSL certificate
using the free Letsencrypt CA. This eliminates the bad certificate
browser warning seen in the Self Signed Deployment
method. Velociraptor is able to use the Letsencrypt protocol to obtain
and manage its own certificates (and automatically rotate them when
they expire).</p><p>For these deployment method, one requires</p><ol><li>A DNS name is required - Let&rsquo;s Encrypt will not issue a certificate for an IP address.</li><li>Optionally the DNS name can be a Dynamic DNS name managed by Google Domains.</li><li>Optionally Authentication via SSO providers can be configured.</li></ol><h2 id=getting-a-domain-name>Getting a domain name</h2><p>An SSL certificate says that the DNS name is owned by the server which
presents it. Therefore SSL goes hand in hand with DNS. It is not
currently possible to get a Letsencrypt certificate for an IP address.</p><p>Therefore the first thing you need to do is to buy a DNS domain from
any provider. Once there, you need to set up a DNS A Record to point
at your Velociraptor server&rsquo;s external IP.</p><p>You can use a dynamic DNS client such as ddclient to update your
DNS->IP mapping dynamically. Alternative, Velociraptor directly
supports updating Google Domains Dynamic DNS so this is the easiest
option since it requires the least amount of configuration.</p><p>In this example we use Google Domains to purchase our domain, but any
other domain provider would work as well.</p><h2 id=provisioning-a-virtual-machine>Provisioning a Virtual Machine</h2><p>Next we provision an Ubuntu VM from any cloud provider. Depending on
your deployment size your VM should be large enough. An 8 or 16Gb VM
should be sufficient for around 5-10k clients. Additionally we will
need sufficient disk space to hold the data we will collect. We
recommend to start with a modest amount of storage and then either
backup data as it gets collected or increase the storage volume as
needed.</p><div class="mynotices warning"><div><p>It is essential to ensure that inbound filtering ACLs allow our
virtual machine to receive connections over <strong>both</strong> ports 80 and 443.
When using SSL both the client communication <strong>and</strong> the GUI are served
over the same ports to benefit from SSL transport encryption. The
Letsencrypt protocol requires Letsencrypt&rsquo;s servers to connect to the
VM on port 80 - however the GUI itself will only be served over SSL.</p></div></div><p>When we deploy our Virtual Machine we may choose either a static IP
address or allow the cloud provider to assign a dynamic IP address. We
typically choose a dynamic IP address and so we need to configure
Dynamic DNS.</p><p>Google Domains allows us to assign a dynamic DNS entry for our
domain by simply selecting a Dynamic DNS record:</p><p><img src=sso1.png alt="DynDNS Dashboard"></p><p>After the dynamic address is created, we can get the credentials for
updating the IP address from the console. We will need these
credential during the interactive configuration process below.</p><h2 id=configure-velociraptor-to-use-autocert>Configure Velociraptor to use autocert</h2><p>Velociraptor can issue its own certificates. Using the guided
configuration wizard we may select this operation mode:</p><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ ./output/velociraptor config generate -i
?
Welcome to the Velociraptor configuration generator
---------------------------------------------------

I will be creating a new deployment configuration for you. I will
begin by identifying what type of deployment you need.

  [Use arrows to move, space to select, type to filter]
  Self Signed SSL
&gt; Automatically provision certificates with Lets Encrypt
</code></pre></div><p>By selecting this option the generated configuration file will ensure:</p><ol><li><p>The server will fetch certificates automatically from Letsencrypt&rsquo;s
servers when first accessed by the browser.</p></li><li><p>Both the Frontend and GUI will be served over the standard SSL port (443).</p></li><li><p>The GUI is therefore externally available (but protected over SSL)
to the internet.</p></li><li><p>Clients will connect to the public DNS name over SSL.</p></li></ol><div class="mynotices tip"><div><p>You must have both ports 80 and 443 publicly accessible by allowing
any inbound firewall rules! Letsencrypt uses both to issue
certificates. If you forgot to open port 80, Letsencrypt will fail to
issue the certificate and this might result in blocking the domain
name from getting an SSL certificate for several days. If you find
this happened, simply change the dyndns name and start again.</p></div></div><p>The first time you connect to the GUI or to the frontend, the server
will obtain its own certificates from letsencrypt (it might take a
couple of seconds to respond the first time). You should have no SSL
warnings in your browser.</p><h2 id=configuring-google-oauth-sso>Configuring Google OAuth SSO</h2><p>In the previous sections we saw how to set up Velociraptor&rsquo;s GUI over
SSL. This is great, but we still need to create users and assign them
passwords manually. The trouble with user account management is that
we can not enforce 2 factor authentication, or any password policies
or any of the usual enterprise requirements for user account
management. It is also difficult for users to remember yet another
password for a separate system, and so might make the password easily
guessable.</p><p>Most enterprise systems require an SSO mechanism to manage user
accounts and passwords. Manual user account management simply does not
scale!</p><p>Velociraptor offers a number of choices of authentication providers:</p><ol><li>Basic Authentication - this stores usernames and passwords in
Velociraptor&rsquo;s own datastore.</li><li>Google, Azure or GitHub OAuth2 providers - Uses these providers to authenticate users via OAuth2.</li><li>OIDC - Uses the Open ID Connect protocol to support many IAM providers (e.g. Okta)</li></ol><h3 id=oauth-identity-management>OAuth Identity management</h3><p>In the following we demonstrate how Velociraptor can be configured to
use Google&rsquo;s oauth mechanism to verify a user&rsquo;s identity. This
requires a user to authenticate to Google via their usual mechanism -
if their account requires 2 factor authentication, then users need to
log in this way.</p><p>Once the user authenticates to Google, they are redirected back into
the Velociraptor application with a token that allows the application
to request information about the user (for example, the username or
email address).</p><div class="mynotices note"><div><p>OAuth is an authentication protocol. This means Velociraptor can be
pretty confident the user is who they claim they are. This does not
automatically grant them access to the application! A Velociraptor
administrator must still manually grant them access before a user may
log in.</p></div></div><p>Before we can use Google for Authentication, we need to register our
Velociraptor deployment as an OAuth App with Google.</p><h3 id=registering-velociraptor-as-an-oauth-application>Registering Velociraptor as an OAuth application</h3><p>The first step is to register Velociraptor as an OAuth app. We do this
by accessing the Google cloud console at
<a href=https://console.cloud.google.com>https://console.cloud.google.com</a> . You will need to set up a cloud
account first and create a cloud project - even if you do not host
your server on Google&rsquo;s cloud platform.</p><p>Our ultimate goal is to obtain OAuth credentials to give our
Velociraptor app, but we have to have a few things set up
first. Navigate to <code>APIs and Services</code> in the GCP console and select
<code>Credentials</code> and the <code>OAuth Consent Screen</code> tab.</p><p><img src=sso11.png alt=11></p><p>Further down we need to provide an authorized domain</p><p><img src=sso12.png alt=11></p><p>In order to add an Authorized domain we need to <em>verify it</em>. Google&rsquo;s
help pages explain it further:</p><div class="mynotices tip"><div><p><strong>Authorized domains</strong>: To protect you and your users, Google
restricts your OAuth 2.0 application to using Authorized
Domains. If you have verified the domain with Google, you can use
any Top Private Domain as an Authorized Domain.</p></div></div><p>In this example we assume that you purchased your domain with Google
domains which makes this step easier since it is already verified.</p><p>We can go back to the cloud console and <code>Create Credentials/OAuth client ID</code>:</p><p><img src=sso15.png alt=11></p><p>Now select <code>Web App</code> and we must set the <code>Authorized redirect URIs</code> to
<code>https://&lt;Your Domain Name>/auth/google/callback</code> -
This is the URL that successful OAuth authentication will redirect
to. Velociraptor accepts this redirect and uses it to log the user on.</p><p><img src=sso16.png alt=11></p><p>If all goes well the Google cloud console will give us a client ID and
a client secret.</p><h3 id=generating-configuration>Generating configuration</h3><p>To generate a self signed deployment start by running the <code>config generate</code> command to invoke the configuration wizard</p><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>velociraptor config generate -i
</code></pre></div><p><img src="config.png?classes=shadow" alt="Generating Cloud Deployment"></p><p>The configuration wizard asks a number of questions and creates a
server and client configuration.</p><ul><li>What OS will the server be deployed on? This choice will affect the
defaults for various options. Production deployments are typically
done on a Linux machine (but the configuration can be generated on
Windows).</li><li>Path to the datastore directory: Velociraptor uses flat files for
all storage. This path is where Velociraptor will write the
files. You should mount any network filesystems or storage devices
on this path.</li><li>The public DNS name of the Frontend: The clients will connect to the
server using this DNS name so it should be publically accessible
(Note this is a DNS name and not a URL).</li><li>Google OAuth2 Client ID and Secret are obtained from above.</li><li>GUI Username or email address to authorize: The initial set of
administrator accounts can be stored in the configuration file. When
Velociraptor starts it will automatically add these accounts as
administrators. When using SSO, Velociraptor does not use any
passwords so only the user names will be recorded.</li></ul><h3 id=user-management>User management</h3><p>The OAuth flow ensures the user&rsquo;s identity is correct but does not
give them permission to log into Velociraptor. Note that having an
OAuth enabled application on the web allows anyone with a Google
identity to authenticate to the application but the user is still
required to be authorized explicitly. If a user is rejected, we can
see the following in the Audit logs:</p><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>   {
     <span style=color:green;font-weight:700>&#34;level&#34;</span>: <span style=color:#ba2121>&#34;error&#34;</span>,
     <span style=color:green;font-weight:700>&#34;method&#34;</span>: <span style=color:#ba2121>&#34;GET&#34;</span>,
     <span style=color:green;font-weight:700>&#34;msg&#34;</span>: <span style=color:#ba2121>&#34;User rejected by GUI&#34;</span>,
     <span style=color:green;font-weight:700>&#34;remote&#34;</span>: <span style=color:#ba2121>&#34;192.168.0.10:40570&#34;</span>,
     <span style=color:green;font-weight:700>&#34;time&#34;</span>: <span style=color:#ba2121>&#34;2018-12-21T18:17:47+10:00&#34;</span>,
     <span style=color:green;font-weight:700>&#34;user&#34;</span>: <span style=color:#ba2121>&#34;mike@velocidex.com&#34;</span>
   }
</code></pre></div><p>In order to authorize the user we must explicitly add them using the
velociraptor admin tool:</p><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ velociraptor --config ~/server.config.yaml user add mike@velocidex.com
Authentication will occur via Google - therefore no password needs to be set.
</code></pre></div><p>Note that this time, Velociraptor does not ask for a password at all,
since authentication occurs using Google&rsquo;s SSO. If we hit refresh in
the browser we should be able to see the Velociraptor application dashboard.</p><p>We can see that the logged in user is authenticated by Google, and we
can also see the user&rsquo;s Google avatar at the top right for some more
eye candy :-).</p><p><img src=dashboard.png alt="Velociraptor Dashboard"></p><div class="mynotices note"><div><p>Velociraptor will retain its OAuth token for 24 hours. Each day users
will need to re-grant OAuth credentials. Therefore revoking a user
from the Google Admin console may take a full day to take effect. To
remove access sooner you should simply remove all permissions from the
user using <code>velociraptor user grant '{}'</code>.</p></div></div><h3 id=deploying-to-the-server>Deploying to the server</h3><p>Once a server configuration file is created it is most convenient to
create a server Debian package embedding the config file.</p><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>velociraptor.exe --config server.config.yaml debian server --binary velociraptor-v0.6.0-linux-amd64
</code></pre></div><p>The above command instructs Velociraptor to build a debian package for
the server using the linux binary specified. The result is a deb
package containing the velociraptor executable, the server
configuration file and relevant startup scripts.</p><div class="mynotices warning"><div><p>The Deb package contains the server configuration file, which contains all required key materials. Make sure the debian file is well protected since a compromise of the file will leak private key material enabling a MITM attack against Velociraptor.</p></div></div><p>You can check the installation using <code>service velociraptor_server status</code>.</p><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ sudo dpkg -i velociraptor_0.3.0_server.deb
Selecting previously unselected package velociraptor-server.
<span style=color:#666>(</span>Reading database ... <span style=color:#666>384556</span> files and directories currently installed.<span style=color:#666>)</span>
Preparing to unpack velociraptor_0.3.0_server.deb ...
Unpacking velociraptor-server <span style=color:#666>(</span>0.3.0<span style=color:#666>)</span> ...
Setting up velociraptor-server <span style=color:#666>(</span>0.3.0<span style=color:#666>)</span> ...
Created symlink /etc/systemd/system/multi-user.target.wants/velociraptor_server.service → /etc/systemd/system/velociraptor_server.service.

$ sudo service velociraptor_server status
● velociraptor_server.service - Velociraptor linux amd64
   Loaded: loaded <span style=color:#666>(</span>/etc/systemd/system/velociraptor_server.service; enabled; vendor preset: enabled<span style=color:#666>)</span>
   Active: active <span style=color:#666>(</span>running<span style=color:#666>)</span> since Sun 2019-07-07 08:49:24 AEST; 17s ago
 Main PID: <span style=color:#666>2275</span> <span style=color:#666>(</span>velociraptor<span style=color:#666>)</span>
    Tasks: <span style=color:#666>13</span> <span style=color:#666>(</span>limit: 4915<span style=color:#666>)</span>
   Memory: 30.2M
   CGroup: /system.slice/velociraptor_server.service
           └─2275 /usr/local/bin/velociraptor --config /etc/velociraptor/server.config.yaml frontend

Jul <span style=color:#666>07</span> 08:49:24 mic-Inspiron systemd<span style=color:#666>[</span>1<span style=color:#666>]</span>: Started Velociraptor linux amd64.
</code></pre></div><div class="mynotices tip"><div><p>You do not need to build the deb package on a Linux machine. If you
prefer to use Windows for your day to day work, you may build the deb
on your windows machine but you must specify the <code>--binary</code> flag to
the <code>debian server</code> command with a path to the linux binary. You can
obtain a copy of the linux binary from the Github releases page.</p></div></div><footer class=footline></footer></div></div><div id=navigation></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/velociraptor-docs/js/clipboard.min.js?1623424129></script><script src=/velociraptor-docs/js/perfect-scrollbar.min.js?1623424129></script><script src=/velociraptor-docs/js/perfect-scrollbar.jquery.min.js?1623424129></script><script src=/velociraptor-docs/js/jquery.sticky.js?1623424129></script><script src=/velociraptor-docs/js/featherlight.min.js?1623424129></script><script src=/velociraptor-docs/js/highlight.pack.js?1623424129></script><script>hljs.initHighlightingOnLoad()</script><script src=/velociraptor-docs/js/modernizr.custom-3.6.0.js?1623424129></script><script src=/velociraptor-docs/js/learn.js?1623424129></script><script src=/velociraptor-docs/js/hugo-learn.js?1623424129></script></body></html>