<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.83.1"><meta name=description content><link rel=icon href=/images/favicon.png type=image/png><title>Deployment Overview :: Velociraptor - Digging deeper!</title><link href=/css/nucleus.css?1623592977 rel=stylesheet><link href=/css/fontawesome-all.min.css?1623592977 rel=stylesheet><link href=/css/hybrid.css?1623592977 rel=stylesheet><link href=/css/featherlight.min.css?1623592977 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1623592977 rel=stylesheet><link href=/css/auto-complete.css?1623592977 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1623592977 rel=stylesheet><link href=/css/theme.css?1623592977 rel=stylesheet><link href=/css/tabs.css?1623592977 rel=stylesheet><link href=/css/hugo-theme.css?1623592977 rel=stylesheet><link href=/css/theme-mine.css?1623592977 rel=stylesheet><link href=/css/atom-one-light.css?1623592977 rel=stylesheet><script src=/js/jquery-3.3.1.min.js?1623592977></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/overview/deployment/><nav id=sidebar><div id=header-wrapper><div id=header><a href=https://docs.velociraptor.app/><img src=https://docs.velociraptor.app//images/logo.svg></a></div></div><div class=highlightable><ul class=topics><li data-nav-id=/overview/ title="Velociraptor Overview" class="dd-item
parent"><a href=/overview/>Velociraptor Overview</a><ul><li data-nav-id=/overview/history/ title=History class=dd-item><a href=/overview/history/>History</a></li><li data-nav-id=/overview/deployment/ title="Deployment Overview" class="dd-item
parent
active"><a href=/overview/deployment/>Deployment Overview</a><ul><li data-nav-id=/overview/deployment/self-signed/ title="Self Signed SSL" class=dd-item><a href=/overview/deployment/self-signed/>Self Signed SSL</a></li><li data-nav-id=/overview/deployment/cloud/ title="Cloud Deployment" class=dd-item><a href=/overview/deployment/cloud/>Cloud Deployment</a></li><li data-nav-id=/overview/deployment/clients/ title="Deploying Clients" class=dd-item><a href=/overview/deployment/clients/>Deploying Clients</a></li><li data-nav-id=/overview/deployment/rbac/ title="Users and Roles" class=dd-item><a href=/overview/deployment/rbac/>Users and Roles</a></li><li data-nav-id=/overview/deployment/resources/ title=Performance class=dd-item><a href=/overview/deployment/resources/>Performance</a></li></ul></li></ul></li><li data-nav-id=/gui/ title="The Admin GUI" class=dd-item><a href=/gui/>The Admin GUI</a><ul><li data-nav-id=/gui/clients/ title="Inspecting clients" class=dd-item><a href=/gui/clients/>Inspecting clients</a></li><li data-nav-id=/gui/vfs/ title="The VFS" class=dd-item><a href=/gui/vfs/>The VFS</a></li><li data-nav-id=/gui/artifacts/ title=Artifacts class=dd-item><a href=/gui/artifacts/>Artifacts</a></li><li data-nav-id=/gui/hunting/ title=Hunting class=dd-item><a href=/gui/hunting/>Hunting</a></li></ul></li><li data-nav-id=/vql/ title="VQL Fundamentals" class=dd-item><a href=/vql/>VQL Fundamentals</a><ul><li data-nav-id=/vql/notebooks/ title=Notebooks class=dd-item><a href=/vql/notebooks/>Notebooks</a></li></ul></li><li data-nav-id=/blog/ title="Velociraptor Blog" class=dd-item><a href=/blog/>Velociraptor Blog</a><ul><li data-nav-id=/blog/2021/ title=2021 class=dd-item><a href=/blog/2021/>2021</a><ul><li data-nav-id=/blog/2021/2021-01-22-concurrent-vql-6d381fdb0b1f/ title="Concurrent VQL" class=dd-item><a href=/blog/2021/2021-01-22-concurrent-vql-6d381fdb0b1f/>Concurrent VQL</a></li><li data-nav-id=/blog/2021/2021-01-19-parsing-binary-files-d31114a41f14/ title="Parsing binary files" class=dd-item><a href=/blog/2021/2021-01-19-parsing-binary-files-d31114a41f14/>Parsing binary files</a></li></ul></li><li data-nav-id=/blog/2020/ title=2020 class=dd-item><a href=/blog/2020/>2020</a><ul><li data-nav-id=/blog/2020/2020-12-26-slack-and-velociraptor-b63803ba4b16/ title="Slack and Velociraptor" class=dd-item><a href=/blog/2020/2020-12-26-slack-and-velociraptor-b63803ba4b16/>Slack and Velociraptor</a></li><li data-nav-id=/blog/2020/2020-12-13-velociraptor-and-osquery-2a4306dd23c/ title="Velociraptor and OSQuery" class=dd-item><a href=/blog/2020/2020-12-13-velociraptor-and-osquery-2a4306dd23c/>Velociraptor and OSQuery</a></li><li data-nav-id=/blog/2020/2020-11-13-the-windows-usn-journal-f0c55c9010e/ title="The Windows USN Journal" class=dd-item><a href=/blog/2020/2020-11-13-the-windows-usn-journal-f0c55c9010e/>The Windows USN Journal</a></li><li data-nav-id=/blog/2020/2020-09-28-velociraptor-network-communications-30568624043a/ title="Velociraptor Communications" class=dd-item><a href=/blog/2020/2020-09-28-velociraptor-network-communications-30568624043a/>Velociraptor Communications</a></li><li data-nav-id=/blog/2020/2020-08-17-velociraptor-sso-authentication-6dd68d46dccf/ title="Velociraptor SSO Authentication" class=dd-item><a href=/blog/2020/2020-08-17-velociraptor-sso-authentication-6dd68d46dccf/>Velociraptor SSO Authentication</a></li><li data-nav-id=/blog/2020/2020-08-16-profiling-the-beast-58913437fd16/ title="Profiling the beast" class=dd-item><a href=/blog/2020/2020-08-16-profiling-the-beast-58913437fd16/>Profiling the beast</a></li><li data-nav-id=/blog/2020/2020-07-14-triage-with-velociraptor-pt-4-cf0e60810d1e/ title="Triage with Velociraptor — Pt 4" class=dd-item><a href=/blog/2020/2020-07-14-triage-with-velociraptor-pt-4-cf0e60810d1e/>Triage with Velociraptor — Pt 4</a></li><li data-nav-id=/blog/2020/2020-07-13-velociraptor-in-the-tool-age-d896dfe71b9/ title="Velociraptor in the tool age" class=dd-item><a href=/blog/2020/2020-07-13-velociraptor-in-the-tool-age-d896dfe71b9/>Velociraptor in the tool age</a></li><li data-nav-id=/blog/2020/2020-06-19-the-velociraptor-query-language-pt-2-fe92bb7aa150/ title="The Velociraptor Query Language Pt 2" class=dd-item><a href=/blog/2020/2020-06-19-the-velociraptor-query-language-pt-2-fe92bb7aa150/>The Velociraptor Query Language Pt 2</a></li><li data-nav-id=/blog/2020/2020-06-14-the-velociraptor-query-language-pt-1-d721bff100bf/ title="The Velociraptor Query Language Pt 1" class=dd-item><a href=/blog/2020/2020-06-14-the-velociraptor-query-language-pt-1-d721bff100bf/>The Velociraptor Query Language Pt 1</a></li><li data-nav-id=/blog/2020/2020-04-16-velociraptor-e48a47e0317d/ title=Velociraptor class=dd-item><a href=/blog/2020/2020-04-16-velociraptor-e48a47e0317d/>Velociraptor</a></li><li data-nav-id=/blog/2020/2020-03-29-velociraptors-acl-model-7f497575daee/ title="Velociraptor’s ACL model" class=dd-item><a href=/blog/2020/2020-03-29-velociraptors-acl-model-7f497575daee/>Velociraptor’s ACL model</a></li><li data-nav-id=/blog/2020/2020-03-28-velociraptor-notebooks-d02e0bd11230/ title="Velociraptor notebooks" class=dd-item><a href=/blog/2020/2020-03-28-velociraptor-notebooks-d02e0bd11230/>Velociraptor notebooks</a></li><li data-nav-id=/blog/2020/2020-03-07-extending-vql-plugins-7fb004cb6ec4/ title="Extending VQL plugins" class=dd-item><a href=/blog/2020/2020-03-07-extending-vql-plugins-7fb004cb6ec4/>Extending VQL plugins</a></li><li data-nav-id=/blog/2020/2020-03-06-velociraptor-post-processing-with-jupyter-notebook-and-pandas-8a344d05ee8c/ title="Velociraptor Post-processing with Jupyter Notebook and Pandas" class=dd-item><a href=/blog/2020/2020-03-06-velociraptor-post-processing-with-jupyter-notebook-and-pandas-8a344d05ee8c/>Velociraptor Post-processing with Jupyter Notebook and Pandas</a></li><li data-nav-id=/blog/2020/2020-01-12_hunting-malware-using-mutants-ea08e86dfc19/ title="Hunting Malware using Mutants" class=dd-item><a href=/blog/2020/2020-01-12_hunting-malware-using-mutants-ea08e86dfc19/>Hunting Malware using Mutants</a></li></ul></li><li data-nav-id=/blog/2019/ title=2019 class=dd-item><a href=/blog/2019/>2019</a><ul><li data-nav-id=/blog/2019/2019-12-31_digging-into-the-system-resource-usage-monitor-srum-afbadb1a375/ title="Digging into the System Resource Usage Monitor (SRUM)" class=dd-item><a href=/blog/2019/2019-12-31_digging-into-the-system-resource-usage-monitor-srum-afbadb1a375/>Digging into the System Resource Usage Monitor (SRUM)</a></li><li data-nav-id=/blog/2019/2019-12-08-velociraptor-to-elasticsearch-3a9fc02c6568/ title="Velociraptor to Elasticsearch" class=dd-item><a href=/blog/2019/2019-12-08-velociraptor-to-elasticsearch-3a9fc02c6568/>Velociraptor to Elasticsearch</a></li><li data-nav-id=/blog/2019/2019-11-15_recovering-deleted-ntfs-files-with-velociraptor-1fcf09855311/ title="Recovering deleted NTFS Files with Velociraptor" class=dd-item><a href=/blog/2019/2019-11-15_recovering-deleted-ntfs-files-with-velociraptor-1fcf09855311/>Recovering deleted NTFS Files with Velociraptor</a></li><li data-nav-id=/blog/2019/2019-11-12_windows-event-logs-d8d8e615c9ca/ title="Windows Event Logs" class=dd-item><a href=/blog/2019/2019-11-12_windows-event-logs-d8d8e615c9ca/>Windows Event Logs</a></li><li data-nav-id=/blog/2019/2019-10-08_triage-with-velociraptor-pt-3-d6f63215f579/ title="Triage with Velociraptor — Pt 3" class=dd-item><a href=/blog/2019/2019-10-08_triage-with-velociraptor-pt-3-d6f63215f579/>Triage with Velociraptor — Pt 3</a></li><li data-nav-id=/blog/2019/2019-10-04_triage-with-velociraptor-pt-2-d0f79066ca0e/ title="Triage with Velociraptor — Pt 2" class=dd-item><a href=/blog/2019/2019-10-04_triage-with-velociraptor-pt-2-d0f79066ca0e/>Triage with Velociraptor — Pt 2</a></li><li data-nav-id=/blog/2019/2019-10-02_triage-with-velociraptor-pt-1-253f57ce96c0/ title="Triage with Velociraptor — Pt 1" class=dd-item><a href=/blog/2019/2019-10-02_triage-with-velociraptor-pt-1-253f57ce96c0/>Triage with Velociraptor — Pt 1</a></li><li data-nav-id=/blog/2019/2019-09-11_velociraptor-s-client-side-buffer-3ce03697a4e6/ title="Velociraptor’s client side buffer" class=dd-item><a href=/blog/2019/2019-09-11_velociraptor-s-client-side-buffer-3ce03697a4e6/>Velociraptor’s client side buffer</a></li><li data-nav-id=/blog/2019/2019-03-02/ title="Agentless hunting with Velociraptor" class=dd-item><a href=/blog/2019/2019-03-02/>Agentless hunting with Velociraptor</a></li></ul></li></ul></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://github.com/Velocidex/velociraptor><i class="fab fa-github"></i> Github repo</a></li></ul></section><section id=footer><p>Built with <a href=https://github.com/matcornic/hugo-theme-learn><i class="fas fa-heart"></i></a> from <a href=https://getgrav.org>Grav</a> and <a href=https://gohugo.io/>Hugo</a></p></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links>Deployment Overview</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li><a href=#typical-deployment>Typical Deployment</a></li><li><a href=#resource-considerations>Resource considerations</a></li><li><a href=#instant-velociraptor>Instant Velociraptor</a></li><li><a href=#command-deployment-scenarios>Command deployment scenarios</a></li><li><a href=#automating-config-generation>Automating config generation</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Deployment Overview</h1><p>Velociraptor can be deployed in a number of scenarios depending on
need. The diagram below illustrates what a typical Velociraptor deployment looks like.</p><p><img src="overview.png?width=80pc&classes=shadow" alt="Deployment Overview"></p><p>The Velociraptor server is typically deployed on a cloud VM and runs a number of components as separate threads. The GUI serves the Admin UI - a Web application that can be used to control Velociraptor and orchestrate hunts and collections from the endpoints.</p><p>The endpoints themselves run the <strong>Velociraptor Client</strong> as a
service. The client is simply the Velociraptor instance running on the
endpoint.</p><p>Clients have a persistent connection with the server. The server is
therefore able to issue a task to the clients immediately as soon as
the User scheduled it (Many other solutions rely on periodic polling
between endpoint and the server leading to latency between issuing a
new task and receiving the results - not so with Velociraptor).</p><p>Velociraptor is distributed as a <strong>Single Binary</strong> for ease of
deployment. The same binary can act as a server, client or a number of
utility programs depending on command line flags.</p><p>Velociraptor does not use an external datastore - all data is stored
within the server&rsquo;s filesystem in regular files and directories making
backups and data lifecycle management a breeze. Therefore you do not
need any additional infrastructure such as databases or cloud
services. Velociraptor is compatible with distributed filesystems such
as Amazon EFS, Google Filestore or generic NFS.</p><h3 id=typical-deployment>Typical Deployment</h3><p>By deployment we mean to stand up a new Velociraptor server instance. Typically this consists of a number of broad steps:</p><ol><li>Generate a configuration file for the server and clients</li><li>Create a server package for deployment which includes the generated configuration file.</li><li>Spin up a cloud VM for the server (If deploying in the cloud) or create a new physical server.</li><li>Install the server package on the VM - this will bring the GUI and frontends up.</li><li>Create client packages for target operating systems (e.g. MSI for windows).</li></ol><p>Each deployment relies on unique configuration files, which include
information such as connection URLs, DNS names and unique
cryptographic keys. The configuration files ensure that one
Velociraptor deployment can not connect with another deployment since
key material is unique to each deployment.</p><div class="mynotices info"><div><p>We typically use Ubuntu or Debian based VMs to deploy the server in
production. We do not support Windows based servers at scale, although
it is fine to install the server on windows for a demo or for a few
endpoints.</p></div></div><h3 id=resource-considerations>Resource considerations</h3><p>The secret behind Velociraptor&rsquo;s scalability lies in the use of VQL to
query the endpoint. The server does not usually have to do much work:
All the server does is send a VQL query to the endpoints. The VQL
query executes on the endpoint and any results from the query (Queries
always returns rows encoded in JSON) are sent back to the server. The
server simply needs to write the queries into its filesystem &ndash;
Typically the server does not need to parse or process the responses
from the endpoint.</p><p>Because the server performs minimal processing on the collected data,
it is able to handle a very high volume of requests simultaneously.</p><p>See <a href=resources>Performance Considerations</a> for a discussion of
resource sizing and scale related tuning parameters available.</p><h3 id=instant-velociraptor>Instant Velociraptor</h3><p>If you just want to play with Velociraptor, you do not need to deploy
a complete server. Simply download the Velociraptor executable for
your platform from the <a href=https://github.com/Velocidex/velociraptor/releases>GitHub project&rsquo;s releases page</a>
and start it with the <code>gui</code> command.</p><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>Velociraptor.exe gui
</code></pre></div><p>The <code>gui</code> command automatically creates a new server and client
configuration files with the server:</p><ul><li>Server only listening on the local loopback interface.</li><li>Client will connect to the server over the loopback.</li><li>Datastore directory is set to the user&rsquo;s temp folder.</li><li>A single administrator user is created with username <code>admin</code> and password <code>password</code>.</li><li>A browser is launched with those credentials to connect to the welcome screen.</li></ul><div class="mynotices tip"><div><p>By default the <code>gui</code> command uses the temp folder
as it&rsquo;s data store. Most OS&rsquo;s clean the temp folder periodically so if
you frequently use the same folder you might find missing files. You
can specify a different data store directory using the <code>--datastore</code>
flag to work with a persistently stored data store.</p></div></div><h3 id=command-deployment-scenarios>Command deployment scenarios</h3><ul class="children children-li"><li><a href=/overview/deployment/self-signed/>Self Signed SSL</a></li><li><a href=/overview/deployment/cloud/>Cloud Deployment</a></li><li><a href=/overview/deployment/clients/>Deploying Clients</a></li><li><a href=/overview/deployment/rbac/>Users and Roles</a></li><li><a href=/overview/deployment/resources/>Performance</a></li></ul><h4 id=self-signed-ssl-mode>Self Signed SSL mode</h4><p>Frontend served using TLS on port 8000 (connected to clients)
GUI uses basic authentication with usernames/passwords.
GUI Served over loopback port 8889 (127.0.0.1)
By default not exposed to the network
You can use SSH tunneling to forward the GUI</p><h4 id=installing-a-new-server>Installing a new server</h4><p>Use the password provided in the Workshop setup to log into the server.
Fetch the latest Velociraptor Windows and Linux release binaries
Create a new configuration</p><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>velociraptor config generate -i
</code></pre></div><p>Create a new server debian package</p><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>velociraptor.exe --config server.config.yaml debian server  --binary velociraptor-v0.5.5-windows.exe
</code></pre></div><h4 id=installing-a-new-server-1>Installing a new server</h4><p>Push the debian package to the server using scp</p><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>scp velociraptor_server*.deb mike@123.45.67.89:/tmp/
</code></pre></div><p>Install package</p><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>sudo dpkg -i velociraptor_server*.deb
</code></pre></div><h3 id=automating-config-generation>Automating config generation</h3><p>Some people want to automate the config generation step.
Velociraptor supports a JSON merge for non interactive configuration generation</p><div class=highlight><pre style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>velociraptor config generate --merge
    <span style=color:#ba2121>&#39;{&#34;autocert_domain&#34;: &#34;domain.com&#34;, &#34;autocert_cert_cache&#34;: &#34;/foo/bar&#34;}&#39;</span>
</code></pre></div><p>The service adds a new velociraptor user to run under.
You can now access the Velociraptor server using your browser.</p><p>The first time you navigate to the SSL URL the server will obtain a
certificate from Let&rsquo;s Encrypt. There will be a small pause as this
happens.</p><p>You will be redirected to Google for authentication - Velociraptor
does not handle any credentials in this configuration. Google will
determine if the user authenticated properly (2 FA etc) and convey
simple info like the user’s email address and avatar.</p><footer class=footline></footer></div></div><div id=navigation></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1623592977></script><script src=/js/perfect-scrollbar.min.js?1623592977></script><script src=/js/perfect-scrollbar.jquery.min.js?1623592977></script><script src=/js/jquery.sticky.js?1623592977></script><script src=/js/featherlight.min.js?1623592977></script><script src=/js/highlight.pack.js?1623592977></script><script>hljs.initHighlightingOnLoad()</script><script src=/js/modernizr.custom-3.6.0.js?1623592977></script><script src=/js/learn.js?1623592977></script><script src=/js/hugo-learn.js?1623592977></script></body></html>