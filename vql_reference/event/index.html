<!doctype html><html lang=en class="js csstransforms3d">
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=generator content="Hugo 0.91.2">
<meta name=description content>
<link rel=icon href=/images/favicon.png type=image/png>
<title>Event Plugins :: Velociraptor - Digging deeper!</title>
<link href=/css/nucleus.css?1641961736 rel=stylesheet>
<link href=/css/fontawesome-all.min.css?1641961736 rel=stylesheet>
<link href=/css/featherlight.min.css?1641961736 rel=stylesheet>
<link href=/css/perfect-scrollbar.min.css?1641961736 rel=stylesheet>
<link href=/css/auto-complete.css?1641961736 rel=stylesheet>
<link href=/css/theme.css?1641961736 rel=stylesheet>
<link href=/css/tabs.css?1641961736 rel=stylesheet>
<link href=/css/hugo-theme.css?1641961736 rel=stylesheet>
<link href=/css/theme-mine.css?1641961736 rel=stylesheet>
<link href=/css/dark.css?1641961736 rel=stylesheet><link href=/css/syntax.css?1641961736 rel=stylesheet><link href=/css/light.css?1641961736 rel=stylesheet><link href=/css/hljs.css?1641961736 rel=stylesheet><link href=https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css?1641961736 rel=stylesheet>
<script src=/js/jquery-3.3.1.min.js?1641961736></script>
<style>:root #header+#content>#left>#rlblock_left{display:none!important}</style>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QYH72LMYCS"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-QYH72LMYCS',{anonymize_ip:!1})}</script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','G-QYH72LMYCS','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
<script></script>
</head>
<body data-url=/vql_reference/event/>
<nav id=sidebar><div id=header-wrapper>
<div id=header>
<script>function darkmode(){$("body").addClass("dark").removeClass("light"),document.cookie="theme=darkmode;path=/"}function lightmode(){$("body").removeClass("dark").addClass("light"),document.cookie="theme=lightmode;path=/"}const regex=new RegExp('theme=darkmode');regex.test(document.cookie)?darkmode():lightmode()</script>
<div class="btn btn-default ThemeSelector darkmode" onclick=darkmode()>
<i class="fas fa-moon"></i>
</div>
<div class="btn btn-default ThemeSelector lightmode" onclick=lightmode()>
<i class="fas fa-sun"></i>
</div>
<a href=https://docs.velociraptor.app/>
<img src=https://docs.velociraptor.app//images/logo.svg>
</a>
</div>
</div>
<div class=highlightable>
<ul class=topics>
<li data-nav-id=https://docs.velociraptor.app/announcements/ class="dd-item haschildren">
<div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/announcements/><i class="fas fa-bullhorn"></i>Announcements</a>
</div>
<ul>
<li data-nav-id=https://docs.velociraptor.app/announcements/2021-artifact-contest/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/announcements/2021-artifact-contest/>2021 Contest</a>
</div>
</li>
</ul>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/ class="dd-item haschildren">
<div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/><i class="fas fa-book-reader"></i>Documentation</a>
</div>
<ul>
<li data-nav-id=https://docs.velociraptor.app/docs/overview/ class="dd-item haschildren">
<div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/overview/>Velociraptor Overview</a>
</div>
<ul>
<li data-nav-id=https://docs.velociraptor.app/docs/overview/history/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/overview/history/>History</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/overview/support/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/overview/support/>Support Policy</a>
</div>
</li>
</ul>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/deployment/ class="dd-item haschildren">
<div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/deployment/>Deployment</a>
</div>
<ul>
<li data-nav-id=https://docs.velociraptor.app/docs/deployment/self-signed/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/self-signed/>Self-Signed SSL</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/deployment/cloud/ class="dd-item haschildren">
<div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/deployment/cloud/>Cloud Deployment</a>
</div>
<ul>
<li data-nav-id=https://docs.velociraptor.app/docs/deployment/cloud/multifrontend/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/cloud/multifrontend/>Multi-Frontend</a>
</div>
</li>
</ul>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/deployment/clients/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/clients/>Deploying Clients</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/deployment/rbac/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/rbac/>Users and Roles</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/deployment/resources/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/resources/>Performance</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/deployment/troubleshooting/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/troubleshooting/>Troubleshooting</a>
</div>
</li>
</ul>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/gui/ class="dd-item haschildren">
<div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/gui/>The Admin GUI</a>
</div>
<ul>
<li data-nav-id=https://docs.velociraptor.app/docs/gui/clients/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/gui/clients/>Inspecting clients</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/gui/vfs/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/gui/vfs/>The VFS</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/gui/artifacts/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/gui/artifacts/>Artifacts</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/gui/hunting/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/gui/hunting/>Hunting</a>
</div>
</li>
</ul>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/vql/ class="dd-item haschildren">
<div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/vql/>VQL Fundamentals</a>
</div>
<ul>
<li data-nav-id=https://docs.velociraptor.app/docs/vql/notebooks/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/vql/notebooks/>Notebooks</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/vql/artifacts/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/vql/artifacts/>Artifacts</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/vql/events/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/vql/events/>Event Queries</a>
</div>
</li>
</ul>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/forensic/ class="dd-item haschildren">
<div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/forensic/>Forensic Analysis</a>
</div>
<ul>
<li data-nav-id=https://docs.velociraptor.app/docs/forensic/filesystem/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/filesystem/>Searching Filenames</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/forensic/searching/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/searching/>Searching Content</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/forensic/ntfs/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/ntfs/>NTFS Analysis</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/forensic/binary/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/binary/>Binary parsing</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/forensic/evidence_of_execution/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/evidence_of_execution/>Evidence Of Execution</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/forensic/event_logs/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/event_logs/>Event Logs</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/forensic/volatile/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/volatile/>Volatile State</a>
</div>
</li>
</ul>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/offline_triage/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/offline_triage/>Triage and acquisition</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/client_monitoring/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/client_monitoring/>Client Monitoring</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/extending_vql/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/extending_vql/>Extending VQL</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/server_automation/ class="dd-item haschildren">
<div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/server_automation/>Server Automation</a>
</div>
<ul>
<li data-nav-id=https://docs.velociraptor.app/docs/server_automation/server_api/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/server_automation/server_api/>Server API</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/server_automation/server_monitoring/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/server_automation/server_monitoring/>Server Monitoring</a>
</div>
</li>
</ul>
</li>
</ul>
</li><hr>
<li data-nav-id=https://docs.velociraptor.app/vql_reference/ class="dd-item parent haschildren">
<div>
<i class="fa fa-angle-down fa-sm category-icon"></i>
<a href=/vql_reference/><i class="fas fa-book"></i>VQL Reference</a>
</div>
<ul>
<li data-nav-id=https://docs.velociraptor.app/vql_reference/basic/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/basic/>Basic VQL</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/vql_reference/linux/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/linux/>Linux Specific</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/vql_reference/windows/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/windows/>Windows Specific</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/vql_reference/parsers/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/parsers/>Parsers</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/vql_reference/server/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/server/>Server Side</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/vql_reference/plugin/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/plugin/>Client Side</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/vql_reference/event/ class="dd-item parent active">
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/event/>Event Plugins</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/vql_reference/experimental/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/experimental/>Experimental</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/vql_reference/misc/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/misc/>Misc</a>
</div>
</li>
</ul>
</li>
<li data-nav-id=https://docs.velociraptor.app/training/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/training/><i class="fas fa-graduation-cap"></i>Training</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/blog/ class="dd-item haschildren">
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/blog/><i class="fas fa-newspaper"></i>Blog</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/presentations/ class="dd-item haschildren">
<div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/presentations/><i class="fas fa-chalkboard-teacher"></i>Presentations</a>
</div>
<ul>
<li data-nav-id=https://docs.velociraptor.app/presentations/2021_dfrws_us/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/presentations/2021_dfrws_us/>DFRWS US 2021 Workshop</a>
</div>
</li>
</ul>
</li>
<li data-nav-id=https://docs.velociraptor.app/exchange/ class="dd-item haschildren">
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/exchange/><i class="fas fa-code"></i>Artifact Exchange</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/search/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/search/><i class="fas fa-search"></i>Search</a>
</div>
</li>
</ul>
<hr>
<section id=shortcuts>
<h3></h3>
<ul>
<li>
<a class=padding href=https://github.com/Velocidex/velociraptor><i class="fab fa-github"></i>Github</a>
</li>
<li>
<a class=padding href=https://docs.velociraptor.app/discord/><i class="fab fa-discord"></i>Discord</a>
</li>
<li>
<a class=padding href=mailto:velociraptor-discuss@googlegroups.com><i class="fas fa-envelope"></i>Mailing List</a>
</li>
</ul>
</section>
<section id=footer>
<div class=footer-copyright>Brought to you by
<img src=/images/Rapid7_logo.svg class=rapid7>
<br> <i class="fas fa-copyright"></i> 2021
</div>
</section>
</div>
</nav>
<script>$("#sidebar i.fa-angle-right").each(function(){$(this).parent().parent().find("ul").hide()})</script>
<section id=body>
<div id=overlay></div>
<div class="padding highlightable">
<div>
<div id=top-bar>
<div id=top-github-link>
<a class=github-link title="Edit this page" href=https://github.com/scudette/velociraptor-docs/edit/master/content/vql_reference/event/_index.md target=blank>
<i class="fas fa-code-branch"></i>
<span id=top-github-link-text>Edit this page</span>
</a>
</div>
<div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb>
<span id=sidebar-toggle-span>
<a href=# id=sidebar-toggle data-sidebar-toggle>
<i class="fas fa-bars"></i>
</a>
</span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links>
Event Plugins
</span>
</div>
<div class=progress>
<div class=wrapper>
<nav id=TableOfContents>
<ul>
<li><a href=#clock>clock</a>
<ul>
<li><a href=#example>Example</a></li>
</ul>
</li>
<li><a href=#combine>combine</a></li>
<li><a href=#diff>diff</a>
<ul>
<li><a href=#example-1>Example</a></li>
</ul>
</li>
<li><a href=#fifo>fifo</a>
<ul>
<li><a href=#example-2>Example</a></li>
</ul>
</li>
<li><a href=#send_event>send_event</a></li>
<li><a href=#watch_auditd>watch_auditd</a></li>
<li><a href=#watch_csv>watch_csv</a></li>
<li><a href=#watch_etw>watch_etw</a></li>
<li><a href=#watch_evtx>watch_evtx</a></li>
<li><a href=#watch_monitoring>watch_monitoring</a></li>
<li><a href=#watch_syslog>watch_syslog</a></li>
<li><a href=#watch_usn>watch_usn</a></li>
<li><a href=#wmi_events>wmi_events</a></li>
</ul>
</nav>
</div>
</div>
</div>
</div>
<div id=head-tags>
</div>
<div id=body-inner>
<h1>
Event Plugins
</h1>
<p>VQL Event plugins are plugins which never terminate - but instead
generate rows based on events. Event plugins are useful for creating
client monitoring artifacts. Currently, client side monitoring
artifacts are specified in the <code>Events</code> section of the server
configuration file. When clients connect to the server, they receive a
list of monitoring artifacts they are to run. The client runs all
artifacts in parallel and their results are streamed to the server.</p>
<div class=vql_item></div>
<h2 id=clock>clock</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Generate a timestamp periodically. This is mostly useful for event
queries.</p>
<p>This plugin generates events periodically. The periodicity can be
controlled either via the <code>period</code> or the <code>ms</code> parameter. Each row
will be a go <a href=https://golang.org/pkg/time/#Time>time.Time</a>
object. You can access its unix epoch time with the Sec column.</p>
<h3 id=example>Example</h3>
<p>The following will generate an event every 10 seconds.</p>
<pre><code class=language-sql>SELECT Sec FROM clock(period=10)
</code></pre>
<p>The <code>start</code> parameter can be used to schedule the plugin to start
at a particular time. This can be an integer (which will be
interpreted as seconds since the epoch), a string or a time value.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>start</td>
<td>Start at this time.</td>
<td>Any</td>
</tr>
<tr>
<td>period</td>
<td>Wait this many seconds between events.</td>
<td>int64</td>
</tr>
<tr>
<td>ms</td>
<td>Wait this many ms between events.</td>
<td>int64</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=combine>combine</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Combine the output of several queries into the same result set.A convenience plugin acting like chain(async=TRUE).</p>
<div class=vql_item></div>
<h2 id=diff>diff</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Executes &lsquo;query&rsquo; periodically and emit differences from the last query.</p>
<p>The <code>diff()</code> plugin runs a non-event query periodically and calculates
the difference between its result set from the last run.</p>
<p>This can be used to create event queries which watch for changes from
simpler non-event queries.</p>
<p>The <code>key</code> parameter is the name of the column which is used to
determine row equivalency.</p>
<div class="mynotices note">
<div heading=note><p>There is only a single equivalence column specified by the <code>key</code>
parameter, and it must be a string. If you need to watch multiple
columns you need to create a new column which is the concatenation
of other columns. For example <code>format(format="%s%d", args=[Name, Pid])</code></p>
</div>
</div>
<h3 id=example-1>Example</h3>
<p>The following VQL monitors all removable drives and lists files on
newly inserted drives, or files that have been added to removable
drives.</p>
<pre><code class=language-sql>LET removable_disks = SELECT Name AS Drive, Size
FROM glob(globs=&quot;/*&quot;, accessor=&quot;file&quot;)
WHERE Data.Description =~ &quot;Removable&quot;

LET file_listing = SELECT FullPath, Mtime As Modified, Size
FROM glob(globs=Drive+&quot;\\**&quot;, accessor=&quot;file&quot;) LIMIT 1000

SELECT * FROM diff(
  query={ SELECT * FROM foreach(row=removable_disks, query=file_listing) },
  key=&quot;FullPath&quot;,
  period=10)
  WHERE Diff = &quot;added&quot;
</code></pre>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>query</td>
<td>Source for cached rows.</td>
<td>StoredQuery (required)</td>
</tr>
<tr>
<td>key</td>
<td>The column to use as key.</td>
<td>string (required)</td>
</tr>
<tr>
<td>period</td>
<td>Number of seconds between evaluation of the query.</td>
<td>int64</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=fifo>fifo</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Executes &lsquo;query&rsquo; and cache a number of rows from it. For each invocation
we present the set of past rows.</p>
<p>The <code>fifo()</code> plugin allows for VQL queries to apply across historical
data. The fifo plugin accepts another event query as parameter, then
retains the last <code>max_rows</code> rows from it in an internal queue. Every
subsequent evaluation from the query will return the full set of rows
in the queue. Older rows are expired from the queue according to the
<code>max_age</code> parameter.</p>
<p>Fifos are usually used to form queries that look for specific pattern
of behavior. For example, a successful logon followed by failed
logons. In this case the fifo retains the recent history of failed
logons in its internal queue, then when a successful logon occurs we
can check the recent failed ones in its queue.</p>
<h3 id=example-2>Example</h3>
<p>The following checks for 5 failed logons followed by a successful
logon.</p>
<pre><code class=language-sql>LET failed_logon = SELECT EventData as FailedEventData,
   System as FailedSystem
FROM watch_evtx(filename=securityLogFile)
WHERE System.EventID.Value = 4625

LET last_5_events = SELECT FailedEventData, FailedSystem
    FROM fifo(query=failed_logon,
              max_rows=500,
              max_age=atoi(string=failedLogonTimeWindow))

LET success_logon = SELECT EventData as SuccessEventData,
   System as SuccessSystem
FROM watch_evtx(filename=securityLogFile)
WHERE System.EventID.Value = 4624

SELECT * FROM foreach(
  row=success_logon,
  query={
   SELECT SuccessSystem.TimeCreated.SystemTime AS LogonTime,
          SuccessSystem, SuccessEventData,
          enumerate(items=FailedEventData) as FailedEventData,
          FailedSystem, count(items=SuccessSystem) as Count
   FROM last_5_events
   WHERE FailedEventData.SubjectUserName = SuccessEventData.SubjectUserName
   GROUP BY LogonTime
      })  WHERE Count &gt; atoi(string=failureCount)
</code></pre>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>query</td>
<td>Source for cached rows.</td>
<td>StoredQuery (required)</td>
</tr>
<tr>
<td>max_age</td>
<td>Maximum number of seconds to hold rows in the fifo.</td>
<td>int64</td>
</tr>
<tr>
<td>max_rows</td>
<td>Maximum number of rows to hold in the fifo.</td>
<td>int64</td>
</tr>
<tr>
<td>flush</td>
<td>If specified we flush all rows from cache after the call.</td>
<td>bool</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=send_event>send_event</h2>
<p><span class="vql_type pull-right">Function</span></p>
<p>Sends an event to a server event monitoring queue.</p>
<p>This is used to send an event to a waiting server event monitoring
artifact (either as a VQL query running on the server or perhaps
an external program waiting for this event via the API.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>artifact</td>
<td>The artifact name to send the event to.</td>
<td>string (required)</td>
</tr>
<tr>
<td>row</td>
<td>The row to send to the artifact</td>
<td>ordereddict.Dict (required)</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=watch_auditd>watch_auditd</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Watch log files generated by auditd.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>filename</td>
<td>A list of log files to parse.</td>
<td>list of string (required)</td>
</tr>
<tr>
<td>accessor</td>
<td>The accessor to use.</td>
<td>string</td>
</tr>
<tr>
<td>buffer_size</td>
<td>Maximum size of line buffer.</td>
<td>int</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=watch_csv>watch_csv</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Watch a CSV file and stream events from it. Note: This is an event
plugin which does not complete.</p>
<p>This plugin is the event version of <code>parse_csv()</code>. When the CSV file
grows this plugin will emit the new rows.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>filename</td>
<td>CSV files to open</td>
<td>list of string (required)</td>
</tr>
<tr>
<td>accessor</td>
<td>The accessor to use</td>
<td>string</td>
</tr>
<tr>
<td>auto_headers</td>
<td>If unset the first row is headers</td>
<td>bool</td>
</tr>
<tr>
<td>separator</td>
<td>Comma separator (default &lsquo;,')</td>
<td>string</td>
</tr>
<tr>
<td>comment</td>
<td>The single character that should be considered a comment</td>
<td>string</td>
</tr>
<tr>
<td>columns</td>
<td>The columns to use</td>
<td>list of string</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=watch_etw>watch_etw</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Watch for events from an ETW provider.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>A session name</td>
<td>string</td>
</tr>
<tr>
<td>guid</td>
<td>A Provider GUID to watch</td>
<td>string (required)</td>
</tr>
<tr>
<td>any</td>
<td>Any Keywords</td>
<td>uint64</td>
</tr>
<tr>
<td>all</td>
<td>All Keywords</td>
<td>uint64</td>
</tr>
<tr>
<td>level</td>
<td>Log level (0-5)</td>
<td>int64</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=watch_evtx>watch_evtx</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Watch an EVTX file and stream events from it.</p>
<p>This is the Event plugin version of <code>parse_evtx()</code>.</p>
<div class="mynotices note">
<div heading=note><p>It often takes several seconds for events to be flushed to the event
log and so this plugin&rsquo;s event may be delayed. For some applications
this results in a race condition with the event itself - for example,
files mentioned in the event may already be removed by the time the
event is triggered.</p>
</div>
</div>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>filename</td>
<td>A list of event log files to parse.</td>
<td>list of string (required)</td>
</tr>
<tr>
<td>accessor</td>
<td>The accessor to use.</td>
<td>string</td>
</tr>
<tr>
<td>messagedb</td>
<td>A Message database from <a href=https://github.com/Velocidex/evtx-data>https://github.com/Velocidex/evtx-data</a>.</td>
<td>string</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=watch_monitoring>watch_monitoring</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Watch clients&rsquo; monitoring log. This is an event plugin. This
plugin will produce events from all clients.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>artifact</td>
<td>The artifact to watch</td>
<td>string</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=watch_syslog>watch_syslog</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Watch a syslog file and stream events from it.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>filename</td>
<td>A list of log files to parse.</td>
<td>list of string (required)</td>
</tr>
<tr>
<td>accessor</td>
<td>The accessor to use.</td>
<td>string</td>
</tr>
<tr>
<td>buffer_size</td>
<td>Maximum size of line buffer.</td>
<td>int</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=watch_usn>watch_usn</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Watch the USN journal from a device.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>device</td>
<td>The device file to open.</td>
<td>string (required)</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=wmi_events>wmi_events</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Executes an evented WMI queries asynchronously.</p>
<p>This plugin sets up a <a href=https://docs.microsoft.com/en-us/windows/desktop/wmisdk/receiving-a-wmi-event>WMI event</a> listener query.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>query</td>
<td>WMI query to run.</td>
<td>string (required)</td>
</tr>
<tr>
<td>namespace</td>
<td>WMI namespace</td>
<td>string (required)</td>
</tr>
<tr>
<td>wait</td>
<td>Wait this many seconds for events and then quit.</td>
<td>int64 (required)</td>
</tr>
</tbody>
</table>
<footer class=footline>
</footer>
</div>
</div>
<div id=navigation>
</div>
</section>
<div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px>
<div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div>
</div>
<script src=/js/clipboard.min.js?1641961736></script>
<script src=/js/perfect-scrollbar.min.js?1641961736></script>
<script src=/js/perfect-scrollbar.jquery.min.js?1641961736></script>
<script src=/js/jquery.sticky.js?1641961736></script>
<script src=/js/featherlight.min.js?1641961736></script>
<script src=/js/highlight.min.js?1641961736></script>
<script>hljs.highlightAll()</script>
<script src=/js/modernizr.custom-3.6.0.js?1641961736></script>
<script src=/js/learn.js?1641961736></script>
<script src=/js/hugo-learn.js?1641961736></script>
</body>
</html>