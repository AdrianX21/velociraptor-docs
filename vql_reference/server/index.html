<!doctype html><html lang=en class="js csstransforms3d">
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=generator content="Hugo 0.89.1">
<meta name=description content>
<link rel=icon href=/images/favicon.png type=image/png>
<title>Server Side :: Velociraptor - Digging deeper!</title>
<link href=/css/nucleus.css?1636340103 rel=stylesheet>
<link href=/css/fontawesome-all.min.css?1636340103 rel=stylesheet>
<link href=/css/featherlight.min.css?1636340103 rel=stylesheet>
<link href=/css/perfect-scrollbar.min.css?1636340103 rel=stylesheet>
<link href=/css/auto-complete.css?1636340103 rel=stylesheet>
<link href=/css/theme.css?1636340103 rel=stylesheet>
<link href=/css/tabs.css?1636340103 rel=stylesheet>
<link href=/css/hugo-theme.css?1636340103 rel=stylesheet>
<link href=/css/theme-mine.css?1636340103 rel=stylesheet>
<link href=/css/dark.css?1636340103 rel=stylesheet><link href=/css/syntax.css?1636340103 rel=stylesheet><link href=/css/light.css?1636340103 rel=stylesheet><link href=/css/hljs.css?1636340103 rel=stylesheet><link href=https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css?1636340103 rel=stylesheet>
<script src=/js/jquery-3.3.1.min.js?1636340103></script>
<style>:root #header+#content>#left>#rlblock_left{display:none!important}</style>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QYH72LMYCS"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-QYH72LMYCS',{anonymize_ip:!1})}</script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','G-QYH72LMYCS','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
<script></script>
</head>
<body data-url=/vql_reference/server/>
<nav id=sidebar><div id=header-wrapper>
<div id=header>
<script>function darkmode(){$("body").addClass("dark").removeClass("light"),document.cookie="theme=darkmode;path=/"}function lightmode(){$("body").removeClass("dark").addClass("light"),document.cookie="theme=lightmode;path=/"}const regex=new RegExp('theme=darkmode');regex.test(document.cookie)?darkmode():lightmode()</script>
<div class="btn btn-default ThemeSelector darkmode" onclick=darkmode()>
<i class="fas fa-moon"></i>
</div>
<div class="btn btn-default ThemeSelector lightmode" onclick=lightmode()>
<i class="fas fa-sun"></i>
</div>
<a href=https://docs.velociraptor.app/>
<img src=https://docs.velociraptor.app//images/logo.svg>
</a>
</div>
</div>
<div class=highlightable>
<ul class=topics>
<li data-nav-id=https://docs.velociraptor.app/announcements/ class="dd-item haschildren">
<div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/announcements/><i class="fas fa-bullhorn"></i>Announcements</a>
</div>
<ul>
<li data-nav-id=https://docs.velociraptor.app/announcements/2021-artifact-contest/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/announcements/2021-artifact-contest/>2021 Contest</a>
</div>
</li>
</ul>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/ class="dd-item haschildren">
<div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/><i class="fas fa-book-reader"></i>Documentation</a>
</div>
<ul>
<li data-nav-id=https://docs.velociraptor.app/docs/overview/ class="dd-item haschildren">
<div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/overview/>Velociraptor Overview</a>
</div>
<ul>
<li data-nav-id=https://docs.velociraptor.app/docs/overview/history/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/overview/history/>History</a>
</div>
</li>
</ul>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/deployment/ class="dd-item haschildren">
<div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/deployment/>Deployment</a>
</div>
<ul>
<li data-nav-id=https://docs.velociraptor.app/docs/deployment/self-signed/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/self-signed/>Self-Signed SSL</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/deployment/cloud/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/cloud/>Cloud Deployment</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/deployment/clients/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/clients/>Deploying Clients</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/deployment/rbac/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/rbac/>Users and Roles</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/deployment/resources/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/resources/>Performance</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/deployment/troubleshooting/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/troubleshooting/>Troubleshooting</a>
</div>
</li>
</ul>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/gui/ class="dd-item haschildren">
<div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/gui/>The Admin GUI</a>
</div>
<ul>
<li data-nav-id=https://docs.velociraptor.app/docs/gui/clients/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/gui/clients/>Inspecting clients</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/gui/vfs/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/gui/vfs/>The VFS</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/gui/artifacts/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/gui/artifacts/>Artifacts</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/gui/hunting/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/gui/hunting/>Hunting</a>
</div>
</li>
</ul>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/vql/ class="dd-item haschildren">
<div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/vql/>VQL Fundamentals</a>
</div>
<ul>
<li data-nav-id=https://docs.velociraptor.app/docs/vql/notebooks/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/vql/notebooks/>Notebooks</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/vql/artifacts/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/vql/artifacts/>Artifacts</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/vql/events/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/vql/events/>Event Queries</a>
</div>
</li>
</ul>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/forensic/ class="dd-item haschildren">
<div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/forensic/>Forensic Analysis</a>
</div>
<ul>
<li data-nav-id=https://docs.velociraptor.app/docs/forensic/filesystem/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/filesystem/>Searching Filenames</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/forensic/searching/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/searching/>Searching Content</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/forensic/ntfs/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/ntfs/>NTFS Analysis</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/forensic/evidence_of_execution/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/evidence_of_execution/>Evidence Of Execution</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/forensic/event_logs/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/event_logs/>Event Logs</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/forensic/volatile/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/volatile/>Volatile State</a>
</div>
</li>
</ul>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/offline_triage/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/offline_triage/>Triage and acquisition</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/client_monitoring/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/client_monitoring/>Client Monitoring</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/extending_vql/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/extending_vql/>Extending VQL</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/server_automation/ class="dd-item haschildren">
<div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/server_automation/>Server Automation</a>
</div>
<ul>
<li data-nav-id=https://docs.velociraptor.app/docs/server_automation/server_api/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/server_automation/server_api/>Server API</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/docs/server_automation/server_monitoring/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/server_automation/server_monitoring/>Server Monitoring</a>
</div>
</li>
</ul>
</li>
</ul>
</li><hr>
<li data-nav-id=https://docs.velociraptor.app/vql_reference/ class="dd-item parent haschildren">
<div>
<i class="fa fa-angle-down fa-sm category-icon"></i>
<a href=/vql_reference/><i class="fas fa-book"></i>VQL Reference</a>
</div>
<ul>
<li data-nav-id=https://docs.velociraptor.app/vql_reference/basic/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/basic/>Basic VQL</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/vql_reference/windows/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/windows/>Windows Specific</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/vql_reference/parsers/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/parsers/>Parsers</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/vql_reference/server/ class="dd-item parent active">
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/server/>Server Side</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/vql_reference/plugin/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/plugin/>Client Side</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/vql_reference/event/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/event/>Event Plugins</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/vql_reference/experimental/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/experimental/>Experimental</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/vql_reference/misc/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/misc/>Misc</a>
</div>
</li>
</ul>
</li>
<li data-nav-id=https://docs.velociraptor.app/training/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/training/><i class="fas fa-graduation-cap"></i>Training</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/blog/ class="dd-item haschildren">
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/blog/><i class="fas fa-newspaper"></i>Blog</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/presentations/ class="dd-item haschildren">
<div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/presentations/><i class="fas fa-chalkboard-teacher"></i>Presentations</a>
</div>
<ul>
<li data-nav-id=https://docs.velociraptor.app/presentations/2021_dfrws_us/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/presentations/2021_dfrws_us/>DFRWS US 2021 Workshop</a>
</div>
</li>
</ul>
</li>
<li data-nav-id=https://docs.velociraptor.app/exchange/ class="dd-item haschildren">
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/exchange/><i class="fas fa-code"></i>Artifact Exchange</a>
</div>
</li>
<li data-nav-id=https://docs.velociraptor.app/search/ class=dd-item>
<div>
<i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/search/><i class="fas fa-search"></i>Search</a>
</div>
</li>
</ul>
<hr>
<section id=shortcuts>
<h3></h3>
<ul>
<li>
<a class=padding href=https://github.com/Velocidex/velociraptor><i class="fab fa-github"></i>Github</a>
</li>
<li>
<a class=padding href=https://docs.velociraptor.app/discord/><i class="fab fa-discord"></i>Discord</a>
</li>
<li>
<a class=padding href=mailto:velociraptor-discuss@googlegroups.com><i class="fas fa-envelope"></i>Mailing List</a>
</li>
</ul>
</section>
<section id=footer>
<div class=footer-copyright>Brough to you by
<img src=/images/Rapid7_logo.svg class=rapid7>
<br> <i class="fas fa-copyright"></i> 2021
</div>
</section>
</div>
</nav>
<script>$("#sidebar i.fa-angle-right").each(function(){$(this).parent().parent().find("ul").hide()})</script>
<section id=body>
<div id=overlay></div>
<div class="padding highlightable">
<div>
<div id=top-bar>
<div id=top-github-link>
<a class=github-link title="Edit this page" href=https://github.com/scudette/velociraptor-docs/edit/master/content/vql_reference/server/_index.md target=blank>
<i class="fas fa-code-branch"></i>
<span id=top-github-link-text>Edit this page</span>
</a>
</div>
<div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb>
<span id=sidebar-toggle-span>
<a href=# id=sidebar-toggle data-sidebar-toggle>
<i class="fas fa-bars"></i>
</a>
</span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links>
Server Side
</span>
</div>
<div class=progress>
<div class=wrapper>
<nav id=TableOfContents>
<ul>
<li><a href=#artifact_definitions>artifact_definitions</a></li>
<li><a href=#artifact_delete>artifact_delete</a></li>
<li><a href=#artifact_set>artifact_set</a></li>
<li><a href=#cancel_flow>cancel_flow</a></li>
<li><a href=#client_delete>client_delete</a></li>
<li><a href=#client_info>client_info</a></li>
<li><a href=#client_metadata>client_metadata</a></li>
<li><a href=#client_set_metadata>client_set_metadata</a></li>
<li><a href=#clients>clients</a></li>
<li><a href=#collect_client>collect_client</a></li>
<li><a href=#compress>compress</a></li>
<li><a href=#create_flow_download>create_flow_download</a></li>
<li><a href=#create_hunt_download>create_hunt_download</a></li>
<li><a href=#elastic_upload>elastic_upload</a></li>
<li><a href=#enumerate_flow>enumerate_flow</a></li>
<li><a href=#favorites_save>favorites_save</a></li>
<li><a href=#file_store>file_store</a></li>
<li><a href=#file_store_delete>file_store_delete</a></li>
<li><a href=#flow_results>flow_results</a></li>
<li><a href=#flows>flows</a></li>
<li><a href=#get_client_monitoring>get_client_monitoring</a></li>
<li><a href=#get_server_monitoring>get_server_monitoring</a></li>
<li><a href=#gui_users>gui_users</a></li>
<li><a href=#hunt>hunt</a>
<ul>
<li><a href=#notes>NOTES</a></li>
</ul>
</li>
<li><a href=#hunt_add>hunt_add</a></li>
<li><a href=#adding-an-existing-flow-to-a-hunt>Adding an existing flow to a hunt.</a></li>
<li><a href=#hunt_flows>hunt_flows</a></li>
<li><a href=#hunt_results>hunt_results</a></li>
<li><a href=#hunts>hunts</a></li>
<li><a href=#inventory>inventory</a></li>
<li><a href=#inventory_add>inventory_add</a></li>
<li><a href=#inventory_get>inventory_get</a></li>
<li><a href=#label>label</a></li>
<li><a href=#mail>mail</a></li>
<li><a href=#monitoring>monitoring</a></li>
<li><a href=#notebook_delete>notebook_delete</a></li>
<li><a href=#parallelize>parallelize</a></li>
<li><a href=#patch>patch</a></li>
<li><a href=#rate>rate</a></li>
<li><a href=#sample>sample</a></li>
<li><a href=#server_metadata>server_metadata</a></li>
<li><a href=#server_set_metadata>server_set_metadata</a></li>
<li><a href=#set_client_monitoring>set_client_monitoring</a></li>
<li><a href=#set_server_monitoring>set_server_monitoring</a></li>
<li><a href=#source>source</a></li>
<li><a href=#splunk_upload>splunk_upload</a></li>
<li><a href=#uploads>uploads</a></li>
</ul>
</nav>
</div>
</div>
</div>
</div>
<div id=head-tags>
</div>
<div id=body-inner>
<h1>
Server Side
</h1>
<div class="author pull-right">
<span class=date></span>
</div>
<p>Velociraptor provides complete control of the server within VQL
queries. On the server, the VQL engine contains the following
plugins and functions. You can use this functionality to manage
and automate the server by writing VQL queries.</p>
<p>To reuse server side artifacts, simply create an artifact with
<code>type: SERVER</code> and launch it from the &ldquo;Server Artifacts&rdquo; screen in
the GUI.</p>
<div class=vql_item></div>
<h2 id=artifact_definitions>artifact_definitions</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Dump artifact definitions from the internal repository.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>names</td>
<td>Artifact definitions to dump</td>
<td>list of string</td>
</tr>
<tr>
<td>deps</td>
<td>If true includes all dependencies as well.</td>
<td>bool</td>
</tr>
<tr>
<td>sanitize</td>
<td>If true we remove extra metadata.</td>
<td>bool</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=artifact_delete>artifact_delete</h2>
<p><span class="vql_type pull-right">Function</span></p>
<p>Deletes an artifact from the global repository.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>The Artifact to delete</td>
<td>string</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=artifact_set>artifact_set</h2>
<p><span class="vql_type pull-right">Function</span></p>
<p>Sets an artifact into the global repository.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>definition</td>
<td>Artifact definition in YAML</td>
<td>string</td>
</tr>
<tr>
<td>prefix</td>
<td>Required name prefix</td>
<td>string</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=cancel_flow>cancel_flow</h2>
<p><span class="vql_type pull-right">Function</span></p>
<p>Cancels the flow.</p>
<p>This sends the client an immediate cancelation message and stops
the flow. It also removes any outstanding requests for the client
if there are any.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>client_id</td>
<td></td>
<td>string (required)</td>
</tr>
<tr>
<td>flow_id</td>
<td></td>
<td>string</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=client_delete>client_delete</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Delete all information related to a client from the filestore.</p>
<p>This required the SERVER_ADMIN permission.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>client_id</td>
<td></td>
<td>string (required)</td>
</tr>
<tr>
<td>really_do_it</td>
<td></td>
<td>bool</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=client_info>client_info</h2>
<p><span class="vql_type pull-right">Function</span></p>
<p>Returns client info (like the fqdn) from the datastore.</p>
<p>Velociraptor maintains basic information about the client in the
data store, such as its hostname, OS etc.</p>
<p>This information is refreshed each time the <code>Generic.Client.Info</code>
artifact is collected from the endpoint so it can be out of
date. This process is called &ldquo;interrogation&rdquo; of the endpoint.</p>
<p>You can refresh the entire fleet&rsquo;s datastore by scheduling a
<code>Generic.Client.Info</code> hunt.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>client_id</td>
<td></td>
<td>string (required)</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=client_metadata>client_metadata</h2>
<p><span class="vql_type pull-right">Function</span></p>
<p>Returns client metadata from the datastore.</p>
<p>Client metadata is a set of free form key/value data. Artifacts
may use this metdata or it may simply be used as part of your IR
processes.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>client_id</td>
<td></td>
<td>string (required)</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=client_set_metadata>client_set_metadata</h2>
<p><span class="vql_type pull-right">Function</span></p>
<p>Sets client metadata.</p>
<p>Client metadata is a set of free form key/value data (see
client_metadata() function).</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>client_id</td>
<td></td>
<td>string (required)</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=clients>clients</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Retrieve the list of clients.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>search</td>
<td>Client search string. Can have the following prefixes: &lsquo;label:&rsquo;, &lsquo;host:&rsquo;</td>
<td>string</td>
</tr>
<tr>
<td>start</td>
<td>First client to fetch (0)'</td>
<td>uint64</td>
</tr>
<tr>
<td>count</td>
<td>Maximum number of clients to fetch (1000)'</td>
<td>uint64</td>
</tr>
<tr>
<td>client_id</td>
<td></td>
<td>string</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=collect_client>collect_client</h2>
<p><span class="vql_type pull-right">Function</span></p>
<p>Launch an artifact collection against a client. If the client_id
is &ldquo;server&rdquo; then the collection occurs on the server itself. In
that case the caller needs the SERVER_ADMIN permission.</p>
<p>There are two way of specifying how to collect the artifacts. The
simplest way is to specify the environment string using the <code>env</code>
parameter, and a list of artifacts to collect in the <code>artifacts</code>
parameter.</p>
<p>In this case all artifacts will receive the the same
parameters. For example:</p>
<pre><code class=language-vql>SELECT collect_client(
    client_id='C.11a3013ccaXXXXX',
    artifacts='Windows.KapeFiles.Targets',
    env=dict(Device ='C:', VSSAnalysis='Y', KapeTriage='Y')).request AS Flow
FROM scope()
</code></pre>
<p>Sometimes we have a number of artifacts that use the same
parameter name for different purposes. In that case we wish to
specify precisely which artifact receives which parameter. This
more complex way of specifying the collection using the <code>spec</code>
parameter:</p>
<pre><code class=language-vql>SELECT collect_client(
    client_id='C.11a3013ccaXXXXX',
    artifacts='Windows.KapeFiles.Targets',
    spec=dict(`Windows.KapeFiles.Targets`=dict(
        Device ='C:', VSSAnalysis='Y', KapeTriage='Y'))).request AS Flow
FROM scope()
</code></pre>
<p>In this case the artifact names are repeated in the spec and the
artifacts parameter.</p>
<p>NOTE: When constructing the dictionaries for the spec parameter
you will often need to specify a field name containing full
stop. You can escape this using the backticks like the example above.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>client_id</td>
<td>The client id to schedule a collection on</td>
<td>string (required)</td>
</tr>
<tr>
<td>artifacts</td>
<td>A list of artifacts to collect</td>
<td>list of string (required)</td>
</tr>
<tr>
<td>env</td>
<td>Parameters to apply to the artifact (an alternative to a full spec)</td>
<td>Any</td>
</tr>
<tr>
<td>spec</td>
<td>Parameters to apply to the artifacts</td>
<td>Any</td>
</tr>
<tr>
<td>timeout</td>
<td>Set query timeout (default 10 min)</td>
<td>uint64</td>
</tr>
<tr>
<td>ops_per_sec</td>
<td>Set query ops_per_sec value</td>
<td>float64</td>
</tr>
<tr>
<td>max_rows</td>
<td>Max number of rows to fetch</td>
<td>uint64</td>
</tr>
<tr>
<td>max_bytes</td>
<td>Max number of bytes to upload</td>
<td>uint64</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=compress>compress</h2>
<p><span class="vql_type pull-right">Function</span></p>
<p>Compress a file.</p>
<p>The file is compressed using gzip. You can change the location of
the output using the output parameter.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>path</td>
<td>A path to compress</td>
<td>string (required)</td>
</tr>
<tr>
<td>output</td>
<td>A path to write the output - default is the path with a .gz extension</td>
<td>string</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=create_flow_download>create_flow_download</h2>
<p><span class="vql_type pull-right">Function</span></p>
<p>Creates a download pack for the flow.</p>
<p>This function initiates the download creation process for a
flow. It is equivalent to the GUI functionality allowing to
&ldquo;Download Results&rdquo; from the Flows Overview page.</p>
<p>Using the <code>wait</code> parameter you can wait for the download to
complete or just kick it off asynchronously.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>client_id</td>
<td>Client ID to export.</td>
<td>string (required)</td>
</tr>
<tr>
<td>flow_id</td>
<td>The flow id to export.</td>
<td>string (required)</td>
</tr>
<tr>
<td>wait</td>
<td>If set we wait for the download to complete before returning.</td>
<td>bool</td>
</tr>
<tr>
<td>type</td>
<td>Type of download to create (e.g. &lsquo;report&rsquo;) default a full zip file.</td>
<td>string</td>
</tr>
<tr>
<td>template</td>
<td>Report template to use (defaults to Reporting.Default).</td>
<td>string</td>
</tr>
<tr>
<td>password</td>
<td>An optional password to encrypt the collection zip.</td>
<td>string</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=create_hunt_download>create_hunt_download</h2>
<p><span class="vql_type pull-right">Function</span></p>
<p>Creates a download pack for a hunt.</p>
<p>This function initiates the download creation process for a
hunt. It is equivalent to the GUI functionality allowing to
&ldquo;Download Results&rdquo; from the Hunts Overview page.</p>
<p>Using the <code>wait</code> parameter you can wait for the download to
complete or just kick it off asynchronously.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>hunt_id</td>
<td>Hunt ID to export.</td>
<td>string (required)</td>
</tr>
<tr>
<td>only_combined</td>
<td>If set we only export combined results.</td>
<td>bool</td>
</tr>
<tr>
<td>wait</td>
<td>If set we wait for the download to complete before returning.</td>
<td>bool</td>
</tr>
<tr>
<td>format</td>
<td>Format to export (csv,json) defaults to both.</td>
<td>string</td>
</tr>
<tr>
<td>base</td>
<td>Base filename to write to.</td>
<td>string</td>
</tr>
<tr>
<td>password</td>
<td>An optional password to encrypt the collection zip.</td>
<td>string</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=elastic_upload>elastic_upload</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Upload rows to elastic.</p>
<p>This uses the Elastic bulk upload API to push arbitrary rows to
elastic. The query specified in <code>query</code> will be run and each row
it emits will be uploaded as a separate event to Elastic.</p>
<p>You can either specify the elastic index explicitly using the
<code>index</code> parameter or provide an <code>_index</code> column in the query
itself to send the row to a different index each time.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>query</td>
<td>Source for rows to upload.</td>
<td>StoredQuery (required)</td>
</tr>
<tr>
<td>threads</td>
<td>How many threads to use.</td>
<td>int64</td>
</tr>
<tr>
<td>index</td>
<td>The name of the index to upload to. If not specified ensure a column is named &lsquo;_index&rsquo;.</td>
<td>string</td>
</tr>
<tr>
<td>type</td>
<td>The type of the index to upload to.</td>
<td>string (required)</td>
</tr>
<tr>
<td>chunk_size</td>
<td>The number of rows to send at the time.</td>
<td>int64</td>
</tr>
<tr>
<td>addresses</td>
<td>A list of Elasticsearch nodes to use.</td>
<td>list of string</td>
</tr>
<tr>
<td>username</td>
<td>Username for HTTP Basic Authentication.</td>
<td>string</td>
</tr>
<tr>
<td>password</td>
<td>Password for HTTP Basic Authentication.</td>
<td>string</td>
</tr>
<tr>
<td>cloud_id</td>
<td>Endpoint for the Elastic Service (<a href=https://elastic.co/cloud)>https://elastic.co/cloud)</a>.</td>
<td>string</td>
</tr>
<tr>
<td>api_key</td>
<td>Base64-encoded token for authorization; if set, overrides username and password.</td>
<td>string</td>
</tr>
<tr>
<td>wait_time</td>
<td>Batch elastic upload this long (2 sec).</td>
<td>int64</td>
</tr>
<tr>
<td>pipeline</td>
<td>Pipeline for uploads</td>
<td>string</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=enumerate_flow>enumerate_flow</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Enumerate all the files that make up a flow.</p>
<p>This includes the uploaded files, the result sets and the various
metadata files that result flow state information.</p>
<p>This plugin is mostly used for archiving or deleting a flow from
the filestore.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>client_id</td>
<td></td>
<td>string (required)</td>
</tr>
<tr>
<td>flow_id</td>
<td></td>
<td>string</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=favorites_save>favorites_save</h2>
<p><span class="vql_type pull-right">Function</span></p>
<p>Save a collection into the favorites.</p>
<p>Velociraptor allows the user to save a collection into their
&ldquo;Favorite&rdquo; list. This allows them to quickly and easily pick a
previously used collection.</p>
<p>This VQL function provides an interface for this functionality.</p>
<p>NOTE: A favorite belongs to the calling user - this function will
update the favorite for the calling user only.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>A name for this collection template.</td>
<td>string (required)</td>
</tr>
<tr>
<td>description</td>
<td>A description for the template.</td>
<td>string</td>
</tr>
<tr>
<td>specs</td>
<td>The collection request spec that will be saved. We use this to create the new collection.</td>
<td>LazyExpr (required)</td>
</tr>
<tr>
<td>type</td>
<td>The type of favorite.</td>
<td>string (required)</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=file_store>file_store</h2>
<p><span class="vql_type pull-right">Function</span></p>
<p>Resolves file store paths into full filesystem paths.</p>
<p>This function is only available on the server. It can be used to
find the backing file behind a filestore path so it can be passed
on to an external program.</p>
<p>Velociraptor uses the concept of a Virtual File System to manage the
information about clients etc. The VFS path is a path into the file
store. Of course ultimately (at least in the current implementation)
the file store is storing files on disk, but the disk filename is not
necessarily the same as the VFS path (for example non representable
characters are escaped).</p>
<p>You can use the <code>file_store()</code> function to return the real file path
on disk. This probably only makes sense for VQL queries running on the
server which can independently open the file.</p>
<p>In future the file store may be abstracted (e.g. files may not be
locally stored at all) and this function may stop working.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>path</td>
<td>A VFS path to convert</td>
<td>LazyExpr (required)</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=file_store_delete>file_store_delete</h2>
<p><span class="vql_type pull-right">Function</span></p>
<p>Delete file store paths.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>path</td>
<td>A VFS path to remove</td>
<td>LazyExpr (required)</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=flow_results>flow_results</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Retrieve the results of a flow.</p>
<p>This is similar to the source() plugin.</p>
<p>NOTE: Since a collection can collect multiple artifacts you must
specify the artifact you are interested in.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>artifact</td>
<td>The artifact to retrieve</td>
<td>string</td>
</tr>
<tr>
<td>source</td>
<td>An optional source within the artifact.</td>
<td>string</td>
</tr>
<tr>
<td>flow_id</td>
<td>The hunt id to read.</td>
<td>string (required)</td>
</tr>
<tr>
<td>client_id</td>
<td>The client id to extract</td>
<td>string (required)</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=flows>flows</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Retrieve the flows launched on each client.</p>
<p>Each flow record will include the creator of the flow, the request
and metadata about the collection.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>client_id</td>
<td></td>
<td>string (required)</td>
</tr>
<tr>
<td>flow_id</td>
<td></td>
<td>string</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=get_client_monitoring>get_client_monitoring</h2>
<p><span class="vql_type pull-right">Function</span></p>
<p>Retrieve the current client monitoring state.</p>
<p>The client monitoring table represent&rsquo;s the server configuration
of client event queries to deploy.</p>
<p>This function is designed to allow programmatic manipulation of
the event query table in conjunction with set_client_monitoring()
function.</p>
<p>It is commonly used together with the <code>patch()</code> function to patch
the data structure to add additional event queries.</p>
<div class=vql_item></div>
<h2 id=get_server_monitoring>get_server_monitoring</h2>
<p><span class="vql_type pull-right">Function</span></p>
<p>Retrieve the current server monitoring state.</p>
<p>See <code>get_client_monitoring()</code></p>
<div class=vql_item></div>
<h2 id=gui_users>gui_users</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Retrieve the list of users on the server.</p>
<div class=vql_item></div>
<h2 id=hunt>hunt</h2>
<p><span class="vql_type pull-right">Function</span></p>
<p>Create and launch a hunt.</p>
<p>This function will create a new hunt to collect the specified
artifacts. The artifacts to collect are provided in the
<code>artifacts</code> parameter. Artifact parameters are provided in the
<code>spec</code> parameter (see example below).</p>
<h3 id=notes>NOTES</h3>
<ol>
<li>
<p>In the GUI hunts are always created in the paused
state. This is not the default state when using this function (all
hunts are immediately active - if you want the hunt to be created
in the paused state provide the <code>pause=TRUE</code> parameter).</p>
</li>
<li>
<p>The expiry time is specified in any of the usual time
specification ways (seconds since epoch, or ISO format like
&ldquo;2021-10-02&rdquo;). If the expiry time is in the past, the hunt will
not be created.</p>
</li>
</ol>
<pre><code class=language-vql>SELECT hunt(
    description=&quot;A general hunt&quot;,
    artifacts='Windows.KapeFiles.Targets',
    spec=dict(`Windows.KapeFiles.Targets`=dict(
        Device ='C:', VSSAnalysis='Y', KapeTriage='Y'),
    expires=now() + 18000))
FROM scope()
</code></pre>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>description</td>
<td>Description of the hunt</td>
<td>string (required)</td>
</tr>
<tr>
<td>artifacts</td>
<td>A list of artifacts to collect</td>
<td>list of string (required)</td>
</tr>
<tr>
<td>expires</td>
<td>A time for expiry (e.g. now() + 1800)</td>
<td>LazyExpr</td>
</tr>
<tr>
<td>spec</td>
<td>Parameters to apply to the artifacts</td>
<td>Any</td>
</tr>
<tr>
<td>timeout</td>
<td>Set query timeout (default 10 min)</td>
<td>uint64</td>
</tr>
<tr>
<td>ops_per_sec</td>
<td>Set query ops_per_sec value</td>
<td>float64</td>
</tr>
<tr>
<td>max_rows</td>
<td>Max number of rows to fetch</td>
<td>uint64</td>
</tr>
<tr>
<td>max_bytes</td>
<td>Max number of bytes to upload</td>
<td>uint64</td>
</tr>
<tr>
<td>pause</td>
<td>If specified the new hunt will be in the paused state</td>
<td>bool</td>
</tr>
<tr>
<td>include_labels</td>
<td>If specified only include these labels</td>
<td>list of string</td>
</tr>
<tr>
<td>exclude_labels</td>
<td>If specified exclude these labels</td>
<td>list of string</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=hunt_add>hunt_add</h2>
<p><span class="vql_type pull-right">Function</span></p>
<p>Assign a client to a hunt.</p>
<p>This function allows a client to be added to a hunt. The client
will be immediately scheduled and the results will be added to the
hunt. Clients are added to a hunt regardless of any hunt
conditions, or even if the hunt is stopped.</p>
<p>You can use this function to manually add clients to selected
hunts for example after being triaged or post processed to
identify the clients of interest.</p>
<p>NOTE: An alternative method is to create a hunt that only targets
a specific label and then just assign the label to specific
clients.</p>
<h2 id=adding-an-existing-flow-to-a-hunt>Adding an existing flow to a hunt.</h2>
<p>If a flow_id is specified, this function will just immediately add
the collection to the hunt, without scheduling a new
collection. The results of this flow will be visible when post
processing the hunt, exporting the hunt etc.</p>
<p>This is useful to redo a collection in a hunt - for example, if
some collections in the hunt expired or were cancelled you can
manually re-run these collections and then when successful re-add
them to the hunt.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>client_id</td>
<td></td>
<td>string (required)</td>
</tr>
<tr>
<td>hunt_id</td>
<td></td>
<td>string (required)</td>
</tr>
<tr>
<td>flow_id</td>
<td>If a flow id is specified we do not create a new flow, but instead add this flow_id to the hunt.</td>
<td>string</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=hunt_flows>hunt_flows</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Retrieve the flows launched by a hunt.</p>
<p>A Velociraptor hunt is just a collection of related flows. This
plugin simply enumerates all the flows as part of this hunt.</p>
<p>You can use this to figure out if all the collections were
successful by looking at the result of each flow object.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>hunt_id</td>
<td>The hunt id to inspect.</td>
<td>string (required)</td>
</tr>
<tr>
<td>start_row</td>
<td>The first row to show (used for paging).</td>
<td>int64</td>
</tr>
<tr>
<td>limit</td>
<td>Number of rows to show (used for paging).</td>
<td>int64</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=hunt_results>hunt_results</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Retrieve the results of a hunt.</p>
<p>This plugin essentially iterates over all flows in the hunt and
reads out all collected rows for each client in the same table.</p>
<p>It is equivalent to the source() plugin in the hunt notebook
context.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>artifact</td>
<td>The artifact to retrieve</td>
<td>string</td>
</tr>
<tr>
<td>source</td>
<td>An optional source within the artifact.</td>
<td>string</td>
</tr>
<tr>
<td>hunt_id</td>
<td>The hunt id to read.</td>
<td>string (required)</td>
</tr>
<tr>
<td>brief</td>
<td>If set we return less columns.</td>
<td>bool</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=hunts>hunts</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Retrieve the list of hunts.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>hunt_id</td>
<td>A hunt id to read, if not specified we list all of them.</td>
<td>string</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=inventory>inventory</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Retrieve the tools inventory.</p>
<p>The inventory contains information about all the external tools
Velociraptor is managing. This plugin will display this.</p>
<p>See <a href=https://docs.velociraptor.app/docs/extending_vql/#using-external-tools>https://docs.velociraptor.app/docs/extending_vql/#using-external-tools</a></p>
<div class=vql_item></div>
<h2 id=inventory_add>inventory_add</h2>
<p><span class="vql_type pull-right">Function</span></p>
<p>Add or reconfigure a tool into the inventory.</p>
<p>Note that if you provide a file to override the tool it must be
readable by the server (so the file must reside on the server or
be accessible over a network share).</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>tool</td>
<td></td>
<td>string (required)</td>
</tr>
<tr>
<td>serve_locally</td>
<td></td>
<td>bool</td>
</tr>
<tr>
<td>url</td>
<td></td>
<td>string</td>
</tr>
<tr>
<td>hash</td>
<td></td>
<td>string</td>
</tr>
<tr>
<td>filename</td>
<td>The name of the file on the endpoint</td>
<td>string</td>
</tr>
<tr>
<td>file</td>
<td>An optional file to upload</td>
<td>string</td>
</tr>
<tr>
<td>accessor</td>
<td>The accessor to use to read the file.</td>
<td>string</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=inventory_get>inventory_get</h2>
<p><span class="vql_type pull-right">Function</span></p>
<p>Get tool info from inventory service.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>tool</td>
<td></td>
<td>string (required)</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=label>label</h2>
<p><span class="vql_type pull-right">Function</span></p>
<p>Add the labels to the client. If op is &lsquo;remove&rsquo; then remove these labels.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>client_id</td>
<td>Client ID to label.</td>
<td>string (required)</td>
</tr>
<tr>
<td>labels</td>
<td>A list of labels to apply</td>
<td>list of string (required)</td>
</tr>
<tr>
<td>op</td>
<td>An operation on the labels (set, check, remove)</td>
<td>string</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=mail>mail</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Send Email to a remote server.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>to</td>
<td>Recipient of the mail</td>
<td>list of string (required)</td>
</tr>
<tr>
<td>from</td>
<td>The from email address.</td>
<td>string</td>
</tr>
<tr>
<td>cc</td>
<td>A cc for the mail</td>
<td>list of string</td>
</tr>
<tr>
<td>subject</td>
<td>The subject.</td>
<td>string</td>
</tr>
<tr>
<td>body</td>
<td>The body of the mail.</td>
<td>string (required)</td>
</tr>
<tr>
<td>period</td>
<td>How long to wait before sending the next mail - help to throttle mails.</td>
<td>int64 (required)</td>
</tr>
<tr>
<td>server_port</td>
<td>The SMTP server port to use (default 587).</td>
<td>uint64</td>
</tr>
<tr>
<td>server</td>
<td>The SMTP server to use (if not specified we try the config file).</td>
<td>string</td>
</tr>
<tr>
<td>auth_username</td>
<td>The SMTP username we authenticate to the server.</td>
<td>string</td>
</tr>
<tr>
<td>auth_password</td>
<td>The SMTP username password we use to authenticate to the server.</td>
<td>string</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=monitoring>monitoring</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Extract monitoring log from a client. If client_id is not specified we watch the global journal which contains event logs from all clients.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>client_id</td>
<td>The client id to extract</td>
<td>string</td>
</tr>
<tr>
<td>flow_id</td>
<td>A flow ID (client or server artifacts)</td>
<td>string</td>
</tr>
<tr>
<td>hunt_id</td>
<td>Retrieve sources from this hunt (combines all results from all clients)</td>
<td>string</td>
</tr>
<tr>
<td>artifact</td>
<td>The name of the artifact collection to fetch</td>
<td>string</td>
</tr>
<tr>
<td>source</td>
<td>An optional named source within the artifact</td>
<td>string</td>
</tr>
<tr>
<td>start_time</td>
<td>Start return events from this date (for event sources)</td>
<td>Any</td>
</tr>
<tr>
<td>end_time</td>
<td>Stop end events reach this time (event sources).</td>
<td>Any</td>
</tr>
<tr>
<td>notebook_id</td>
<td>The notebook to read from (should also include cell id)</td>
<td>string</td>
</tr>
<tr>
<td>notebook_cell_id</td>
<td>The notebook cell read from (should also include notebook id)</td>
<td>string</td>
</tr>
<tr>
<td>notebook_cell_table</td>
<td>A notebook cell can have multiple tables.)</td>
<td>int64</td>
</tr>
<tr>
<td>start_row</td>
<td>Start reading the result set from this row</td>
<td>int64</td>
</tr>
<tr>
<td>count</td>
<td>Maximum number of clients to fetch (default unlimited)'</td>
<td>int64</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=notebook_delete>notebook_delete</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Delete a notebook with all its cells.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>notebook_id</td>
<td></td>
<td>string (required)</td>
</tr>
<tr>
<td>really_do_it</td>
<td></td>
<td>bool</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=parallelize>parallelize</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Runs query on result batches in parallel.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>query</td>
<td>The query will be run in parallel over batches.</td>
<td>StoredQuery (required)</td>
</tr>
<tr>
<td>client_id</td>
<td>The client id to extract</td>
<td>string</td>
</tr>
<tr>
<td>flow_id</td>
<td>A flow ID (client or server artifacts)</td>
<td>string</td>
</tr>
<tr>
<td>hunt_id</td>
<td>Retrieve sources from this hunt (combines all results from all clients)</td>
<td>string</td>
</tr>
<tr>
<td>artifact</td>
<td>The name of the artifact collection to fetch</td>
<td>string</td>
</tr>
<tr>
<td>source</td>
<td>An optional named source within the artifact</td>
<td>string</td>
</tr>
<tr>
<td>start_time</td>
<td>Start return events from this date (for event sources)</td>
<td>int64</td>
</tr>
<tr>
<td>end_time</td>
<td>Stop end events reach this time (event sources).</td>
<td>int64</td>
</tr>
<tr>
<td>notebook_id</td>
<td>The notebook to read from (should also include cell id)</td>
<td>string</td>
</tr>
<tr>
<td>notebook_cell_id</td>
<td>The notebook cell read from (should also include notebook id)</td>
<td>string</td>
</tr>
<tr>
<td>notebook_cell_table</td>
<td>A notebook cell can have multiple tables.)</td>
<td>int64</td>
</tr>
<tr>
<td>workers</td>
<td>Number of workers to spawn.)</td>
<td>int64</td>
</tr>
<tr>
<td>batch</td>
<td>Number of rows in each batch.)</td>
<td>int64</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=patch>patch</h2>
<p><span class="vql_type pull-right">Function</span></p>
<p>Patch a JSON object with a json patch or merge.</p>
<p>The function allows for modifications of objects by way of
applying a json patch. You can read more about JSON patching here
<a href=https://github.com/evanphx/json-patch>https://github.com/evanphx/json-patch</a>.</p>
<p>I practice you can use this to update server settings - for
example, consider the client event monitoring state.</p>
<pre><code class=language-text>SELECT get_client_monitoring() FROM scope()

 [
  {
   &quot;get_client_monitoring&quot;: {
    &quot;artifacts&quot;: [
     &quot;Generic.Client.Stats&quot;
    ]
   }
  }
 ]
</code></pre>
<p>Suppose we wish to add a new artifact, we can patch it with the json:</p>
<pre><code class=language-json>[{&quot;op&quot;: &quot;add&quot;, &quot;path&quot;: &quot;/artifacts/0&quot;, &quot;value&quot;: &quot;Windows.Events.DNSQueries&quot;}]
</code></pre>
<p>This can then be immediately pushed to <code>set_client_monitoring()</code>
to update the monitoring state.</p>
<pre><code>SELECT set_client_monitoring(value=patch(
       item=get_client_monitoring(),
       patch=[dict(op=&quot;add&quot;, path=&quot;/artifacts/0&quot;, value=&quot;Windows.Events.DNSQueries&quot;)]))
FROM scope()
</code></pre>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>item</td>
<td>The item to path</td>
<td>Any (required)</td>
</tr>
<tr>
<td>patch</td>
<td>A JSON Patch to apply</td>
<td>Any</td>
</tr>
<tr>
<td>merge</td>
<td>A merge-patch to apply</td>
<td>Any</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=rate>rate</h2>
<p><span class="vql_type pull-right">Function</span></p>
<p>Calculates the rate (derivative) between two quantities.</p>
<p>For example if a monitoring plugin returns an absolute value
sampled in time (e.g. bytes transferred sampled every second) then
the rate() plugin can calculate the average bytes/sec.</p>
<p>This function works by remembering the values of x and y from the
previous row and applying the current rows values.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>x</td>
<td>The X float</td>
<td>float64 (required)</td>
</tr>
<tr>
<td>y</td>
<td>The Y float</td>
<td>float64 (required)</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=sample>sample</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Executes &lsquo;query&rsquo; and samples every n&rsquo;th row.</p>
<p>This is most useful on the server in order to downsample event
artifact results.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>query</td>
<td>Source query.</td>
<td>StoredQuery (required)</td>
</tr>
<tr>
<td>n</td>
<td>Pick every n row from query.</td>
<td>int64 (required)</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=server_metadata>server_metadata</h2>
<p><span class="vql_type pull-right">Function</span></p>
<p>Returns client metadata from the datastore. Client metadata is a set of free form key/value data</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>client_id</td>
<td></td>
<td>string (required)</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=server_set_metadata>server_set_metadata</h2>
<p><span class="vql_type pull-right">Function</span></p>
<p>Sets client metadata. Client metadata is a set of free form key/value data</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>client_id</td>
<td></td>
<td>string (required)</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=set_client_monitoring>set_client_monitoring</h2>
<p><span class="vql_type pull-right">Function</span></p>
<p>Sets the current client monitoring state.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>The Value to set</td>
<td>Any (required)</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=set_server_monitoring>set_server_monitoring</h2>
<p><span class="vql_type pull-right">Function</span></p>
<p>Sets the current server monitoring state.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>The Value to set</td>
<td>Any (required)</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=source>source</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Retrieve rows from an artifact&rsquo;s source.</p>
<p>This plugin is mostly useful in reports. It attempts to do the
right thing automatically by inferring most parameters from its
execution environment.</p>
<p>For example when called within a CLIENT report context, it will
automatically fill its flow id, client id etc. Typically this
means that you only need to specify the source name (for
multi-source artifacts).</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>client_id</td>
<td>The client id to extract</td>
<td>string</td>
</tr>
<tr>
<td>flow_id</td>
<td>A flow ID (client or server artifacts)</td>
<td>string</td>
</tr>
<tr>
<td>hunt_id</td>
<td>Retrieve sources from this hunt (combines all results from all clients)</td>
<td>string</td>
</tr>
<tr>
<td>artifact</td>
<td>The name of the artifact collection to fetch</td>
<td>string</td>
</tr>
<tr>
<td>source</td>
<td>An optional named source within the artifact</td>
<td>string</td>
</tr>
<tr>
<td>start_time</td>
<td>Start return events from this date (for event sources)</td>
<td>Any</td>
</tr>
<tr>
<td>end_time</td>
<td>Stop end events reach this time (event sources).</td>
<td>Any</td>
</tr>
<tr>
<td>notebook_id</td>
<td>The notebook to read from (should also include cell id)</td>
<td>string</td>
</tr>
<tr>
<td>notebook_cell_id</td>
<td>The notebook cell read from (should also include notebook id)</td>
<td>string</td>
</tr>
<tr>
<td>notebook_cell_table</td>
<td>A notebook cell can have multiple tables.)</td>
<td>int64</td>
</tr>
<tr>
<td>start_row</td>
<td>Start reading the result set from this row</td>
<td>int64</td>
</tr>
<tr>
<td>count</td>
<td>Maximum number of clients to fetch (default unlimited)'</td>
<td>int64</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=splunk_upload>splunk_upload</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Upload rows to splunk.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>query</td>
<td>Source for rows to upload.</td>
<td>StoredQuery (required)</td>
</tr>
<tr>
<td>threads</td>
<td>How many threads to use.</td>
<td>int64</td>
</tr>
<tr>
<td>url</td>
<td>The Splunk Event Collector URL.</td>
<td>string</td>
</tr>
<tr>
<td>token</td>
<td>Splunk HEC Token.</td>
<td>string</td>
</tr>
<tr>
<td>index</td>
<td>The name of the index to upload to.</td>
<td>string (required)</td>
</tr>
<tr>
<td>source</td>
<td>The source field for splunk. If not specified this will be &lsquo;velociraptor&rsquo;.</td>
<td>string</td>
</tr>
<tr>
<td>sourcetype</td>
<td>The sourcetype field for splunk. If not specified this will &lsquo;vql&rsquo;</td>
<td>string</td>
</tr>
<tr>
<td>chunk_size</td>
<td>The number of rows to send at the time.</td>
<td>int64</td>
</tr>
<tr>
<td>skip_verify</td>
<td>Skip SSL verification(default: False).</td>
<td>bool</td>
</tr>
<tr>
<td>wait_time</td>
<td>Batch splunk upload this long (2 sec).</td>
<td>int64</td>
</tr>
</tbody>
</table>
<div class=vql_item></div>
<h2 id=uploads>uploads</h2>
<p><span class="vql_type pull-right">Plugin</span></p>
<p>Retrieve information about a flow&rsquo;s uploads.</p>
<div class=vqlargs></div>
<table>
<thead>
<tr>
<th>Arg</th>
<th>Description</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>client_id</td>
<td>The client id to extract</td>
<td>string</td>
</tr>
<tr>
<td>flow_id</td>
<td>A flow ID (client or server artifacts)</td>
<td>string</td>
</tr>
</tbody>
</table>
<footer class=footline>
</footer>
</div>
</div>
<div id=navigation>
</div>
</section>
<div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px>
<div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div>
</div>
<script src=/js/clipboard.min.js?1636340103></script>
<script src=/js/perfect-scrollbar.min.js?1636340103></script>
<script src=/js/perfect-scrollbar.jquery.min.js?1636340103></script>
<script src=/js/jquery.sticky.js?1636340103></script>
<script src=/js/featherlight.min.js?1636340103></script>
<script src=/js/highlight.min.js?1636340103></script>
<script>hljs.highlightAll()</script>
<script src=/js/modernizr.custom-3.6.0.js?1636340103></script>
<script src=/js/learn.js?1636340103></script>
<script src=/js/hugo-learn.js?1636340103></script>
</body>
</html>